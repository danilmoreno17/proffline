package com.promesa.internalFrame.pedidos;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.net.URL;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;

import javax.swing.AbstractAction;
import javax.swing.BorderFactory;
import javax.swing.DefaultCellEditor;
import javax.swing.DefaultComboBoxModel;
import javax.swing.GroupLayout;
import javax.swing.GroupLayout.Alignment;
import javax.swing.ImageIcon;
import javax.swing.InputMap;
import javax.swing.JButton;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JComboBox;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.JScrollPane;
import javax.swing.JSeparator;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.JToolBar;
import javax.swing.JToolBar.Separator;
import javax.swing.KeyStroke;
import javax.swing.LayoutStyle.ComponentPlacement;
import javax.swing.ListSelectionModel;
import javax.swing.ScrollPaneConstants;
import javax.swing.SwingConstants;
import javax.swing.UIManager;
import javax.swing.WindowConstants;
import javax.swing.border.BevelBorder;
import javax.swing.border.SoftBevelBorder;
import javax.swing.event.InternalFrameEvent;
import javax.swing.event.InternalFrameListener;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumn;
import javax.swing.table.TableColumnModel;

import com.promesa.administracion.bean.BeanUsuario;
import com.promesa.administracion.sql.impl.SqlUsuarioImpl;
import com.promesa.bean.BeanConexion;
import com.promesa.bean.BeanDato;
import com.promesa.dialogo.pedidos.DConsultaMateriales2;
import com.promesa.dialogo.pedidos.DHistoricoCliente;
import com.promesa.impresiones.ReporteTicket;
import com.promesa.impresiones.dpp350.ReportePedido;
import com.promesa.impresiones.pedidos.DetalleTicketOrden;
import com.promesa.impresiones.pedidos.TicketOrden;
import com.promesa.internalFrame.pedidos.custom.Item;
import com.promesa.internalFrame.pedidos.custom.ModeloTablaItems;
import com.promesa.internalFrame.pedidos.custom.RenderizadorTablaItems;
import com.promesa.main.Promesa;
import com.promesa.pedidos.bean.BeanAgenda;
import com.promesa.pedidos.bean.BeanClaseMaterial;
import com.promesa.pedidos.bean.BeanCondicionComercial1;
import com.promesa.pedidos.bean.BeanCondicionComercial2;
import com.promesa.pedidos.bean.BeanCondicionComercial3x;
import com.promesa.pedidos.bean.BeanCondicionComercial4x;
import com.promesa.pedidos.bean.BeanCondicionComercial5x;
import com.promesa.pedidos.bean.BeanCondicionExpedicion;
import com.promesa.pedidos.bean.BeanCondicionPago;
import com.promesa.pedidos.bean.BeanMaterial;
import com.promesa.pedidos.bean.BeanMensaje;
import com.promesa.pedidos.bean.BeanPedido;
import com.promesa.pedidos.bean.BeanPedidoDetalle;
import com.promesa.pedidos.bean.BeanPedidoHeader;
import com.promesa.pedidos.bean.BeanPedidoPartners;
import com.promesa.pedidos.bean.BeanSede;
import com.promesa.pedidos.sql.SqlMaterial;
import com.promesa.pedidos.sql.impl.SqlComboImpl;
import com.promesa.pedidos.sql.impl.SqlCondicionExpedicionImpl;
import com.promesa.pedidos.sql.impl.SqlCondicionPagoImpl;
import com.promesa.pedidos.sql.impl.SqlMaterialImpl;
import com.promesa.pedidos.sql.impl.SqlPedidoImpl;
import com.promesa.pedidos.sql.impl.SqlSedeImpl;
import com.promesa.planificacion.bean.BeanCliente;
import com.promesa.planificacion.sql.impl.SqlClienteImpl;
import com.promesa.sap.SPedidos;
import com.promesa.util.Constante;
import com.promesa.util.DLocker;
import com.promesa.util.Mensaje;
import com.promesa.util.Util;
import com.promesa.util.ValidadorEntradasDeTexto;

@SuppressWarnings("serial")
public abstract class IPedidos extends javax.swing.JInternalFrame implements
		FocusListener, InternalFrameListener {

	private boolean flag = false;

	public IPedidos(BeanPedido pedido, String codigoCliente,
			String nombreCliente, String claseRiesgo, String limiteCredito,
			String disponibilidad, String strCondicionPago, String titulo,
			String tituloReporte, String tipoDocumento, int tipoVentana) {
		initComponents();
		SqlClienteImpl sqlCliente = new SqlClienteImpl();
		BeanCliente cliente = sqlCliente.buscarCliente(codigoCliente);
		instancia = this;
		setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
		this.addInternalFrameListener(this);
		this.pedido = pedido;
		this.codigoCliente = codigoCliente;
		this.nombreCliente = nombreCliente;
		this.claseRiesgo = claseRiesgo;
		this.limiteCredito = limiteCredito;
		this.disponibilidad = disponibilidad;
		this.condicionPago = strCondicionPago;
		this.tipoDocumento = tipoDocumento;
		this.tipoVentana = tipoVentana;
		this.lblTitulo.setText(titulo);
		lblTitulo.setVisible(false);
		this.organizacionVentas = cliente.getStrCodOrgVentas();
		this.canalDistribucion = cliente.getStrCodCanalDist();
		this.codigoSector = cliente.getStrCodSector();
		this.txtCondPago.setText(strCondicionPago);
		this.txtDestinatario.setText(codigoCliente);
		this.txtNombre.setText(nombreCliente);
		this.txtClasRiesgo.setText(claseRiesgo);
		this.txtLimCredito.setText(limiteCredito);
		this.txtDisponible.setText(disponibilidad);
		llenarTablaCondicionesPago();
		llenarTablaDestinatarios();
		llenarCondicionesExpedicion();
		enmascararEventoTeclaTab();
		establecerOyenteTeclaTab();
		agregarEventoClicDerecho();
		strDispositivoImpresora = Util.verificarImpresora();
	}

	protected void generarMensaje(String[] mensaje) {
		if (mensaje != null && mensaje.length > 0) {
			String html = "<html><table>";
			URL url = this.getClass().getResource("/imagenes/error.png");
			for (int i = 0; i < mensaje.length; i++) {
				String string = mensaje[i];
				html += "<tr><td><img src=\"" + url + "\"></td><td>" + string
						+ "</td></tr>";
			}
			html += "</table></html>";
			lblWarnigs.setText(html);
		}
	}

	protected void agregarEventoClicDerecho() {
		tblPedidos.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseReleased(MouseEvent e) {
				int r = tblPedidos.rowAtPoint(e.getPoint());
				if (r >= 0 && r < tblPedidos.getRowCount()) {
					tblPedidos.setRowSelectionInterval(r, r);
				} else {
					tblPedidos.clearSelection();
				}
				final int rowindex = tblPedidos.getSelectedRow();
				Item it = mdlTblItems.obtenerItem(rowindex);
				if (it == null)
					return;
				final boolean estaSimulado = it.isSimulado();
				final String codigo = it.getCodigo();
				if (rowindex < 0 || codigo.isEmpty())
					return;
				if (e.isPopupTrigger() && e.getComponent() instanceof JTable) {
					JPopupMenu popup = new JPopupMenu();
					String texto = "";
					JMenuItem labels = new JCheckBoxMenuItem();
					labels.setOpaque(true);
					// Para limpiar la selección
					JMenuItem seleccion = new JCheckBoxMenuItem();
					seleccion.setOpaque(true);
					seleccion.setText("Limpiar selección");
					if (estaSimulado) {
						texto = "Marcar como no confirmado";
						labels.setBackground(new Color(251, 209, 202));
						seleccion.setBackground(new Color(251, 209, 202));
					} else {
						texto = "Marcar como confirmado";
						labels.setBackground(Color.white);
						seleccion.setBackground(Color.white);
					}
					labels.setText(texto);
					labels.addActionListener(new ActionListener() {
						public void actionPerformed(ActionEvent event) {
							mdlTblItems.actualizarEstadoSimulado(rowindex,!estaSimulado);
							tblPedidos.updateUI();
							tblPedidos.clearSelection();
						}
					});
					seleccion.addActionListener(new ActionListener() {
						public void actionPerformed(ActionEvent event) {
							tblPedidos.clearSelection();
						}
					});
					popup.add(labels);
					popup.add(seleccion);
					popup.show(e.getComponent(), e.getX(), e.getY());
				}
			}
		});
	}

	protected void initComponents() {
		pnlBackground = new JPanel();
		lblTitulo = new JLabel();
		pnlContenedor = new JPanel();
		mnuToolBarTop = new JToolBar();
		btnGuardarOrden = new JButton();
		btnCancelar = new JButton();
		btnImprimirComprobante = new JButton();
		pnlDatos = new JPanel();
		separador = new JSeparator();
		pnlInformacion = new JPanel();
		pnlInformacionGeneral = new JPanel();
		pnlUno = new JPanel();
		pnlLabelsUno = new JPanel();
		lblVtaMercaderia = new JLabel();
		lblDestinatario = new JLabel();
		lblBloqEntrega = new JLabel();
		pnlTextsUno = new JPanel();
		txtCodigoPedido = new JTextField();
		pnlVtaMercaderia = new JPanel();
		btnDetalleDestinatario = new JButton();
		txtDestinatario = new JTextField();
		pnlBloqEntrega = new JPanel();
		btnDetalleBloqEntrega = new JButton();
		txtBloqEntrega = new JTextField();
		pnlTres = new JPanel();
		pnlLabels3 = new JPanel();
		lblClasRiesgo = new JLabel();
		lblCondPago = new JLabel();
		pnlTextsTres = new JPanel();
		txtClasRiesgo = new JTextField();
		jPanel9 = new JPanel();
		btnDetalleCondPago = new JButton();
		txtCondPago = new JTextField();
		pnlCuatro = new JPanel();
		pnlLabels4 = new JPanel();
		lblValorNeto = new JLabel();
		lblLimCredito = new JLabel();
		lblDisponible = new JLabel();
		pnlTexts4 = new JPanel();
		txtValorNeto = new JTextField();
		txtLimCredito = new JTextField();
		txtDisponible = new JTextField();
		pnlDos = new JPanel();
		pnlLabelsDos = new JPanel();
		lblNPedCliente = new JLabel();
		lblNombre = new JLabel();
		pnlTextsDos = new JPanel();
		txtNPedCliente = new JTextField();
		txtNombre = new JTextField();
		pnlTabla = new JPanel();
		mnuToolBarMiddle = new JToolBar();
		btnAniadir = new JButton();
		separador2 = new JToolBar.Separator();
		btnEliminar = new JButton();
		separador3 = new JToolBar.Separator();
		btnConsultaCapturaDinamica = new JButton();
		separador4 = new JToolBar.Separator();
		btnGuiaVentas = new JButton();
		btnSimularTodo = new JButton();
		separador5 = new JToolBar.Separator();
		lblMensajes = new JLabel();
		scroller = new JScrollPane();
		tblPedidos = new JTable();
		pnlWarnings = new JPanel();
		lblWarnigs = new JLabel();
		cmbCondExped = new JComboBox();
		setClosable(true);
		setIconifiable(true);
		setMaximizable(true);
		setResizable(true);
		
		String tomaPedido = "/imagenes/toma_pedido.png";
		URL url = this.getClass().getResource(tomaPedido);
		ImageIcon imageIcon = new ImageIcon(url);

		this.setFrameIcon(imageIcon);

		pnlBackground.setLayout(new BorderLayout());

		lblTitulo.setFont(new Font("Tahoma", 1, 18));
		lblTitulo.setText("Pedido <id_cliente> <nombre_cliente>");
		pnlBackground.add(lblTitulo, BorderLayout.PAGE_START);

		pnlContenedor.setLayout(new BorderLayout());

		mnuToolBarTop.setFloatable(false);
		mnuToolBarTop.setRollover(true);

		btnGuardarOrden.setText("Guardar");
		btnGuardarOrden.setFocusable(false);
		btnGuardarOrden.setHorizontalTextPosition(SwingConstants.CENTER);
		btnGuardarOrden.setVerticalTextPosition(SwingConstants.BOTTOM);
		btnGuardarOrden.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent evt) {
				btnGuardarOrdenActionPerformed(evt);
			}
		});
		mnuToolBarTop.add(btnGuardarOrden);

		Separator separador7 = new Separator();
		mnuToolBarTop.add(separador7);

		btnCancelar.setText("Cancelar");
		btnCancelar.setFocusable(false);
		btnCancelar.setHorizontalTextPosition(SwingConstants.CENTER);
		btnCancelar.setVerticalTextPosition(SwingConstants.BOTTOM);
		mnuToolBarTop.add(btnCancelar);

		btnImprimirComprobante.setText("Imprimir");
		btnImprimirComprobante.setFocusable(false);
		btnImprimirComprobante.setHorizontalTextPosition(SwingConstants.CENTER);
		btnImprimirComprobante.setVerticalTextPosition(SwingConstants.BOTTOM);
		separador8 = new Separator();
		mnuToolBarTop.add(separador8);
		mnuToolBarTop.add(btnImprimirComprobante);

		lblWarnigs.setForeground(new java.awt.Color(255, 0, 0));
		lblWarnigs.setBorder(BorderFactory.createEmptyBorder(4, 10, 4, 4));
		pnlWarnings.setLayout(new BorderLayout());
		pnlWarnings.add(lblWarnigs, BorderLayout.CENTER);
		pnlWarnings.add(mnuToolBarTop, BorderLayout.PAGE_START);

		pnlContenedor.add(pnlWarnings, BorderLayout.PAGE_START);

		pnlDatos.setLayout(new BorderLayout());
		pnlDatos.add(separador, BorderLayout.PAGE_START);

		pnlInformacionGeneral.setBorder(BorderFactory.createLineBorder(new Color(0, 0, 0)));

		pnlUno.setLayout(new BorderLayout(5, 5));

		pnlLabelsUno.setLayout(new GridLayout(3, 1));

		lblVtaMercaderia.setText("Vta. Mercadería:");
		pnlLabelsUno.add(lblVtaMercaderia);

		String destino = "<html>Destinatario:<font color='red'> *</font></html>";
		lblDestinatario.setText(destino);
		pnlLabelsUno.add(lblDestinatario);

		lblBloqEntrega.setText("Bloq. Entrega:");
		pnlLabelsUno.add(lblBloqEntrega);

		pnlUno.add(pnlLabelsUno, BorderLayout.LINE_START);

		pnlTextsUno.setLayout(new GridLayout(3, 1, 5, 5));
		pnlTextsUno.add(txtCodigoPedido);

		pnlVtaMercaderia.setLayout(new BorderLayout());

		btnDetalleDestinatario.setPreferredSize(new Dimension(20, 9));
		btnDetalleDestinatario.addActionListener(new ActionListener() {
					public void actionPerformed(ActionEvent evt) {
						btnDetalleDestinatarioActionPerformed(evt);
					}
				});

		btnCancelar.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent evt) {
				cerrar();
			}
		});

		pnlVtaMercaderia.add(btnDetalleDestinatario, BorderLayout.LINE_END);
		pnlVtaMercaderia.add(txtDestinatario, BorderLayout.CENTER);

		pnlTextsUno.add(pnlVtaMercaderia);

		pnlBloqEntrega.setLayout(new BorderLayout());

		btnDetalleBloqEntrega.setPreferredSize(new Dimension(20, 9));
		btnDetalleBloqEntrega.addActionListener(new ActionListener() {
					public void actionPerformed(ActionEvent evt) {
						btnDetalleBloqEntregaActionPerformed(evt);
					}
				});
		txtBloqEntrega.addFocusListener(new FocusAdapter() {
			public void focusGained(FocusEvent evt) {
				if (evt.getSource() == txtBloqEntrega)
					txtBloqEntrega.selectAll();
			}
		});
		pnlBloqEntrega.add(btnDetalleBloqEntrega, BorderLayout.LINE_END);
		pnlBloqEntrega.add(txtBloqEntrega, BorderLayout.CENTER);

		pnlTextsUno.add(pnlBloqEntrega);

		pnlUno.add(pnlTextsUno, BorderLayout.CENTER);

		pnlTres.setLayout(new BorderLayout(5, 5));

		pnlLabels3.setMinimumSize(new Dimension(10, 0));
		pnlLabels3.setPreferredSize(new Dimension(80, 70));
		pnlLabels3.setLayout(new GridLayout(3, 1, 5, 5));

		lblClasRiesgo.setText("Clas. Riesgo:");
		pnlLabels3.add(lblClasRiesgo);

		lblCondPago.setText("<html>Cond. Pago:<font color='red'> *</font></html>");
		pnlLabels3.add(lblCondPago);

		pnlTres.add(pnlLabels3, BorderLayout.LINE_START);

		pnlTextsTres.setLayout(new GridLayout(3, 1, 5, 5));
		pnlTextsTres.add(txtClasRiesgo);

		jPanel9.setLayout(new BorderLayout());

		btnDetalleCondPago.setPreferredSize(new Dimension(20, 9));
		btnDetalleCondPago.addActionListener(new ActionListener() {
					public void actionPerformed(ActionEvent evt) {
						btnDetalleCondPagoActionPerformed(evt);
					}
				});
		jPanel9.add(btnDetalleCondPago, BorderLayout.LINE_END);
		jPanel9.add(txtCondPago, BorderLayout.CENTER);

		pnlTextsTres.add(jPanel9);

		pnlTres.add(pnlTextsTres, BorderLayout.CENTER);

		pnlCuatro.setLayout(new BorderLayout(5, 5));

		pnlLabels4.setLayout(new GridLayout(3, 1, 5, 5));

		lblValorNeto.setText("Valor Neto:");
		pnlLabels4.add(lblValorNeto);

		lblLimCredito.setText("Lim. Crédito:");
		pnlLabels4.add(lblLimCredito);

		lblDisponible.setText("Disponible:");
		pnlLabels4.add(lblDisponible);

		pnlCuatro.add(pnlLabels4, BorderLayout.LINE_START);

		pnlTexts4.setLayout(new GridLayout(3, 1, 5, 5));
		pnlTexts4.add(txtValorNeto);
		pnlTexts4.add(txtLimCredito);
		pnlTexts4.add(txtDisponible);

		pnlCuatro.add(pnlTexts4, BorderLayout.CENTER);

		pnlDos.setLayout(new BorderLayout(5, 5));

		pnlLabelsDos.setMaximumSize(new Dimension(90, 32767));
		pnlLabelsDos.setMinimumSize(new Dimension(90, 42));
		pnlLabelsDos.setPreferredSize(new Dimension(90, 100));
		pnlLabelsDos.setLayout(new GridLayout(3, 1));

		lblNPedCliente.setText("N° ped. cliente:");
		lblNPedCliente.setPreferredSize(new Dimension(60, 14));
		pnlLabelsDos.add(lblNPedCliente);

		lblNombre.setText("Nombre:");
		lblNombre.setPreferredSize(new Dimension(60, 14));
		pnlLabelsDos.add(lblNombre);

		JLabel lblCondExped = new JLabel("Cond. Exped.");
		pnlLabelsDos.add(lblCondExped);

		pnlDos.add(pnlLabelsDos, BorderLayout.LINE_START);

		pnlTextsDos.setLayout(new GridLayout(3, 1, 5, 5));

		txtNPedCliente.addFocusListener(new FocusAdapter() {
			public void focusGained(FocusEvent evt) {
				if (evt.getSource() == txtNPedCliente)
					txtNPedCliente.selectAll();
			}
		});
		pnlTextsDos.add(txtNPedCliente);
		pnlTextsDos.add(txtNombre);
		cmbCondExped.setModel(new DefaultComboBoxModel(
				new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
		pnlTextsDos.add(cmbCondExped);

		pnlDos.add(pnlTextsDos, BorderLayout.CENTER);

		GroupLayout pnlInformacionGeneralLayout = new GroupLayout(pnlInformacionGeneral);
		pnlInformacionGeneral.setLayout(pnlInformacionGeneralLayout);
		pnlInformacionGeneralLayout
				.setHorizontalGroup(pnlInformacionGeneralLayout
						.createParallelGroup(GroupLayout.Alignment.LEADING)
						.addGroup(
								pnlInformacionGeneralLayout
										.createSequentialGroup()
										.addContainerGap()
										.addComponent(
												pnlUno,
												GroupLayout.DEFAULT_SIZE,
												147, Short.MAX_VALUE)
										.addPreferredGap(
												ComponentPlacement.RELATED)
										.addComponent(
												pnlDos,
												GroupLayout.DEFAULT_SIZE,
												214, Short.MAX_VALUE)
										.addPreferredGap(
												ComponentPlacement.RELATED)
										.addComponent(
												pnlTres,
												GroupLayout.DEFAULT_SIZE,
												138, Short.MAX_VALUE)
										.addPreferredGap(
												ComponentPlacement.RELATED)
										.addComponent(
												pnlCuatro,
												GroupLayout.DEFAULT_SIZE,
												129, Short.MAX_VALUE)
										.addContainerGap()));
		pnlInformacionGeneralLayout
				.setVerticalGroup(pnlInformacionGeneralLayout
						.createParallelGroup(Alignment.LEADING)
						.addGroup(
								pnlInformacionGeneralLayout
										.createSequentialGroup()
										.addContainerGap()
										.addGroup(
												pnlInformacionGeneralLayout
														.createParallelGroup(
																Alignment.TRAILING)
														.addComponent(
																pnlCuatro,
																GroupLayout.PREFERRED_SIZE,
																74,
																GroupLayout.PREFERRED_SIZE)
														.addGroup(
																pnlInformacionGeneralLayout
																		.createParallelGroup(
																				Alignment.TRAILING,
																				false)
																		.addComponent(
																				pnlTres,
																				Alignment.LEADING,
																				GroupLayout.DEFAULT_SIZE,
																				GroupLayout.DEFAULT_SIZE,
																				Short.MAX_VALUE)
																		.addComponent(
																				pnlUno,
																				Alignment.LEADING,
																				GroupLayout.DEFAULT_SIZE,
																				GroupLayout.DEFAULT_SIZE,
																				Short.MAX_VALUE)
																		.addComponent(
																				pnlDos,
																				Alignment.LEADING,
																				0,
																				0,
																				Short.MAX_VALUE)))
										.addContainerGap(
												GroupLayout.DEFAULT_SIZE,
												Short.MAX_VALUE)));

		pnlTabla.setLayout(new BorderLayout(5, 5));

		mnuToolBarMiddle.setFloatable(false);
		mnuToolBarMiddle.setRollover(true);

		btnAniadir.setText("Añadir");
		btnAniadir.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		btnAniadir.setFocusable(false);
		btnAniadir.setHorizontalTextPosition(SwingConstants.CENTER);
		btnAniadir.setVerticalTextPosition(SwingConstants.BOTTOM);
		mnuToolBarMiddle.add(btnAniadir);
		mnuToolBarMiddle.add(separador2);

		btnAniadir.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent evt) {
				btnAniadirPedidoActionPerformed(evt);
			}
		});

		btnEliminar.setText("Eliminar");
		btnEliminar.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		btnEliminar.setFocusable(false);
		btnEliminar.setHorizontalTextPosition(SwingConstants.CENTER);
		btnEliminar.setVerticalTextPosition(SwingConstants.BOTTOM);
		mnuToolBarMiddle.add(btnEliminar);
		mnuToolBarMiddle.add(separador3);

		btnConsultaCapturaDinamica.setText("Consulta y Captura Dinámica");
		btnConsultaCapturaDinamica.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		btnConsultaCapturaDinamica.setFocusable(false);
		btnConsultaCapturaDinamica.setHorizontalTextPosition(SwingConstants.CENTER);
		btnConsultaCapturaDinamica.setVerticalTextPosition(SwingConstants.BOTTOM);
		btnConsultaCapturaDinamica
				.addActionListener(new ActionListener() {
					public void actionPerformed(ActionEvent evt) {
						btnConsultaCapturaDinamicaActionPerformed(evt);
					}
				});
		mnuToolBarMiddle.add(btnConsultaCapturaDinamica);
		mnuToolBarMiddle.add(separador4);

		btnGuiaVentas.setText("Histórico de Facturas");
		btnGuiaVentas.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		btnGuiaVentas.setFocusable(false);
		btnGuiaVentas.setHorizontalTextPosition(SwingConstants.CENTER);
		btnGuiaVentas.setVerticalTextPosition(SwingConstants.BOTTOM);
		btnGuiaVentas.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent evt) {
				btnGuiaVentasActionPerformed(evt);
			}
		});

		btnSimularTodo.setText("Calcular precios");
		btnSimularTodo.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		btnSimularTodo.setFocusable(false);
		btnSimularTodo.setHorizontalTextPosition(SwingConstants.CENTER);
		btnSimularTodo.setVerticalTextPosition(SwingConstants.BOTTOM);
		btnSimularTodo.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent evt) {
				btnSimularTodoActionPerformed(evt);
			}
		});
		mnuToolBarMiddle.add(btnGuiaVentas);
		mnuToolBarMiddle.add(separador5);
		mnuToolBarMiddle.add(btnSimularTodo);

		lblMensajes.setText("");
		mnuToolBarMiddle.add(lblMensajes);

		pnlTabla.add(mnuToolBarMiddle, BorderLayout.PAGE_START);

		tblPedidos.setModel(new DefaultTableModel(
				new Object[][] { { null, null, null, null },
						{ null, null, null, null }, { null, null, null, null },
						{ null, null, null, null } }, new String[] { "Title 1",
						"Title 2", "Title 3", "Title 4" }));
		tblPedidos.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
		scroller.setViewportView(tblPedidos);

		pnlTabla.add(scroller, BorderLayout.CENTER);

		GroupLayout pnlInformacionLayout = new GroupLayout(pnlInformacion);
		pnlInformacion.setLayout(pnlInformacionLayout);
		pnlInformacionLayout.setHorizontalGroup(pnlInformacionLayout
						.createParallelGroup(
								GroupLayout.Alignment.LEADING)
						.addGroup(
								Alignment.TRAILING,
								pnlInformacionLayout
										.createSequentialGroup()
										.addContainerGap()
										.addGroup(
												pnlInformacionLayout
														.createParallelGroup(
																Alignment.TRAILING)
														.addComponent(
																pnlTabla,
																Alignment.LEADING,
																GroupLayout.DEFAULT_SIZE,
																668,
																Short.MAX_VALUE)
														.addComponent(
																pnlInformacionGeneral,
																Alignment.LEADING,
																GroupLayout.DEFAULT_SIZE,
																GroupLayout.DEFAULT_SIZE,
																Short.MAX_VALUE))
										.addContainerGap()));
		pnlInformacionLayout
				.setVerticalGroup(pnlInformacionLayout
						.createParallelGroup(
								Alignment.LEADING)
						.addGroup(
								pnlInformacionLayout
										.createSequentialGroup()
										.addContainerGap()
										.addComponent(
												pnlInformacionGeneral,
												GroupLayout.PREFERRED_SIZE,
												GroupLayout.DEFAULT_SIZE,
												GroupLayout.PREFERRED_SIZE)
										.addPreferredGap(
												ComponentPlacement.RELATED)
										.addComponent(
												pnlTabla,
												GroupLayout.DEFAULT_SIZE,
												216, Short.MAX_VALUE)
										.addContainerGap()));

		pnlDatos.add(pnlInformacion, BorderLayout.CENTER);

		pnlContenedor.add(pnlDatos, BorderLayout.CENTER);

		pnlBackground.add(pnlContenedor, BorderLayout.CENTER);

		getContentPane().add(pnlBackground, BorderLayout.CENTER);

		// CUSTOM
		String printPng = "/imagenes/print.png";
		URL urlPrint = this.getClass().getResource(printPng);
		ImageIcon print = new ImageIcon(urlPrint);
		btnImprimirComprobante.setIcon(print);
		
		String guardar32Png = "/imagenes/guardar_32.png";
		URL urlGuardar = this.getClass().getResource(guardar32Png);
		ImageIcon guardar = new ImageIcon(urlGuardar);
		btnGuardarOrden.setIcon(guardar);
		
		String eliminarGif = "/imagenes/eliminar_24.gif";
		URL urlEliminar = this.getClass().getResource(eliminarGif);
		ImageIcon eliminar = new ImageIcon(urlEliminar);
		btnCancelar.setIcon(eliminar);
		
		btnImprimirComprobante.setHorizontalTextPosition(SwingConstants.RIGHT);
		btnImprimirComprobante.setVerticalTextPosition(SwingConstants.CENTER);
		btnGuardarOrden.setHorizontalTextPosition(SwingConstants.RIGHT);
		btnGuardarOrden.setVerticalTextPosition(SwingConstants.CENTER);
		btnCancelar.setHorizontalTextPosition(SwingConstants.RIGHT);
		btnCancelar.setVerticalTextPosition(SwingConstants.CENTER);
		mnuToolBarTop.setBorder(new SoftBevelBorder(BevelBorder.RAISED));
		lblTitulo.setOpaque(true);
		lblTitulo.setBorder(BorderFactory.createEmptyBorder(1, 5,1, 1));

		lblTitulo.setBackground(new Color(175, 200, 222));
		tblPedidos.setModel(mdlTblItems);
		tblPedidos.setDefaultRenderer(String.class, render);
		tblPedidos.setRowHeight(Constante.ALTO_COLUMNAS);
		pack();
		for (int i = 0; i < 12; i++) {
			agregarItemVacio(-1);
		}
		tblPedidos.updateUI();
		selectionModel = tblPedidos.getSelectionModel();
		this.setAnchoColumnas();
		((DefaultTableCellRenderer) tblPedidos.getTableHeader()
				.getDefaultRenderer()).setHorizontalAlignment(JLabel.CENTER);

		btnImprimirComprobante.addActionListener(new java.awt.event.ActionListener() {
					public void actionPerformed(java.awt.event.ActionEvent evt) {
						btmImprimirComprobanteActionPerformed(evt);
					}
				});
		btnEliminar.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				btnEliminarPedidoActionPerformed(evt);
			}
		});
		tblPedidos.getTableHeader().setReorderingAllowed(false);
		txtValorNeto.setEditable(false);
		txtLimCredito.setEditable(false);
		txtDisponible.setEditable(false);
		txtCodigoPedido.setEditable(false);
		txtClasRiesgo.setEditable(false);
		txtDestinatario.setEditable(false);
		txtNombre.setEditable(false);
		txtCondPago.setEditable(false);
		txtBloqEntrega.setEditable(false);
	}// </editor-fold>

	protected void btmImprimirComprobanteActionPerformed(ActionEvent evt) {
		try {
			if (Constante.IMPRESORA_NEW.equals(strDispositivoImpresora)) {
				try {
					imprimirDPP350(tituloImpresion);
					imprimirDPP350("-  COPIA  -");
				} catch (Exception e) {
					imprimir(tituloImpresion);
				}
			} else {
				imprimir(tituloImpresion);
			}
		} catch (Exception e) {
			Mensaje.mostrarError(e.getMessage());
			Util.mostrarExcepcion(e);
		}
	}

	protected void btnSimularTodoActionPerformed(ActionEvent evt) {
		simularPreciosTodosMateriales();
	}

	private void llenarCondicionesExpedicion() {
		SqlCondicionExpedicionImpl controller = new SqlCondicionExpedicionImpl();
		controller.setListaCondicionExpedicion();
		Object[] condiciones = controller.getListaCondicionExpedicion()
				.toArray();
		cmbCondExped.setModel(new DefaultComboBoxModel(condiciones));
	}

	protected void llenarTablaDestinatarios() {
		try {
			tablaSucursales = new JTable(modeloSucursales);
			tablaSucursales.getTableHeader().setReorderingAllowed(false);
			modeloSucursales.setRowCount(0);
			tablaSucursales.getColumn("CÓDIGO").setMaxWidth(80);
			tablaSucursales.getColumn("CÓDIGO").setMinWidth(80);
			tablaSucursales.getColumn("CÓDIGO").setPreferredWidth(80);
			tablaSucursales.getColumn("DIRECCIÓN").setMaxWidth(320);
			tablaSucursales.getColumn("DIRECCIÓN").setMinWidth(320);
			tablaSucursales.getColumn("DIRECCIÓN").setPreferredWidth(320);
			scrollSucursales = new JScrollPane();
			scrollSucursales
					.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_ALWAYS);
			scrollSucursales
					.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
			scrollSucursales.setViewportView(tablaSucursales);
			scrollSucursales.setPreferredSize(new Dimension(400, 100));
			popupSucursales = new JPopupMenu();
			popupSucursales.add(scrollSucursales);
			tablaSucursales.addMouseListener(new MouseAdapter() {
				public void mouseClicked(MouseEvent evt) {
					seleccionarDestinatario(evt);
				}
			});
			SqlSedeImpl sedes = new SqlSedeImpl();
			sedes.setListarSede(codigoCliente);
			List<BeanSede> listaSedes = sedes.getListaSede();
			for (BeanSede beanSede : listaSedes) {
				String[] values = new String[] { beanSede.getCodigo(),
						beanSede.getDireccion() };
				if (beanSede.getCodigo().compareTo(codigoCliente) == 0) {
					direccionDestinatario = beanSede.getDireccion();
				}
				modeloSucursales.addRow(values);
			}
		} catch (Exception exec) {
			Util.mostrarExcepcion(exec);
		}
	}

	protected void llenarTablaCondicionesPago() {
		try {
			tablaCondiciones = new JTable(modelCondiciones);
			tablaCondiciones.getTableHeader().setReorderingAllowed(false);
			modelCondiciones.setRowCount(0);
			tablaCondiciones.getColumn("CONDICIÓN DE PAGO").setMaxWidth(150);
			tablaCondiciones.getColumn("CONDICIÓN DE PAGO").setMinWidth(150);
			tablaCondiciones.getColumn("CONDICIÓN DE PAGO").setPreferredWidth(
					150);
			tablaCondiciones.getColumn("ACLARACIÓN PROPIA").setMaxWidth(250);
			tablaCondiciones.getColumn("ACLARACIÓN PROPIA").setMinWidth(250);
			tablaCondiciones.getColumn("ACLARACIÓN PROPIA").setPreferredWidth(
					250);
			scrollerCondiciones = new JScrollPane();
			int hScrollAlways = ScrollPaneConstants.HORIZONTAL_SCROLLBAR_ALWAYS;
			scrollerCondiciones.setHorizontalScrollBarPolicy(hScrollAlways);
			int vScrollAlways = ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS;
			scrollerCondiciones.setVerticalScrollBarPolicy(vScrollAlways);
			scrollerCondiciones.setViewportView(tablaCondiciones);
			scrollerCondiciones.setPreferredSize(new Dimension(400, 200));
			popupCondiciones = new JPopupMenu();
			popupCondiciones.add(scrollerCondiciones);
			tablaCondiciones.addMouseListener(new MouseAdapter() {
				public void mouseClicked(MouseEvent evt) {
					seleccionarCondicionPago(evt);
				}
			});

			condiciones = new SqlCondicionPagoImpl();
			String condicionPagoClienteXDefecto;
			SqlClienteImpl sqlCliente = new SqlClienteImpl();

			condicionPagoClienteXDefecto = sqlCliente
					.obtenerCondicionPagoPorDefecto(codigoCliente);

			List<BeanCondicionPago> lista = condiciones
					.listarCondicionesPagoPorCliente(condicionPagoClienteXDefecto);
			for (BeanCondicionPago beanCondicionPago : lista) {
				String[] strings = new String[2];
				strings[0] = beanCondicionPago.getTxtZTERM();
				strings[1] = beanCondicionPago.getTxtVTEXT();
				if (strings[0].compareTo(condicionPago) == 0) {
					descripcionCondicionPago = strings[1];
				}
				modelCondiciones.addRow(strings);
			}
		} catch (Exception exec) {
			Util.mostrarExcepcion(exec);
		}
	}

	protected abstract void llenarTablaBloqueosEntrega();

	protected void seleccionarDestinatario(MouseEvent evt) {
		int fila = 0;
		fila = tablaSucursales.getSelectedRow();
		popupSucursales.setVisible(false);
		String destinatario = tablaSucursales.getValueAt(fila,0).toString();
		txtDestinatario.setText(destinatario);
		direccionDestinatario = tablaSucursales.getValueAt(fila,1).toString();
	}

	protected void seleccionarCondicionPago(MouseEvent evt) {
		int fila = 0;
		fila = tablaCondiciones.getSelectedRow();
		popupCondiciones.setVisible(false);
		String condPago = tablaCondiciones.getValueAt(fila, 0).toString();
		txtCondPago.setText(condPago);
		descripcionCondicionPago = tablaCondiciones.getValueAt(fila, 1).toString();
		condicionPago = tablaCondiciones.getValueAt(fila, 0).toString();
		// Llamar a la simulación
		simularPreciosTodosMateriales();
	}

	protected void seleccionarBloqueoEntrega(MouseEvent evt) {
		int fila = 0;
		fila = tablaBloqueos.getSelectedRow();
		popupBloqueo.setVisible(false);
		String bloq = tablaBloqueos.getValueAt(fila, 0).toString();
		txtBloqEntrega.setText(bloq);
	}

	protected void btnDetalleDestinatarioActionPerformed(
			java.awt.event.ActionEvent evt) {
		setPopupDestinatarios(evt, txtDestinatario, 0, 21);
	}

	protected void btnDetalleCondPagoActionPerformed(
			java.awt.event.ActionEvent evt) {
		if (tblPedidos.getCellEditor() != null) {
			tblPedidos.getCellEditor().stopCellEditing();
		}
		setPopupCondiciones(evt, txtCondPago, 0, 21);
	}

	protected void btnDetalleBloqEntregaActionPerformed(ActionEvent evt) {
		setPopupBloqueo(evt, txtBloqEntrega, 0, 21);
	}

	protected void setPopupDestinatarios(ActionEvent evt,
			JTextField txtDestinatario2, int x, int y) {
		txtDestinatario2.add(popupSucursales);
		popupSucursales.show(txtDestinatario2, x, y);
		txtDestinatario2.requestFocus();
		popupSucursales.setVisible(true);
	}

	protected void setPopupCondiciones(ActionEvent evt,
			JTextField txtCondPago2, int x, int y) {
		txtCondPago2.add(popupCondiciones);
		popupCondiciones.show(txtCondPago2, x - 400 + txtCondPago2.getWidth(),
				y);
		txtCondPago2.requestFocus();
		popupCondiciones.setVisible(true);
	}

	protected void setPopupBloqueo(java.awt.event.ActionEvent evt,
			JTextField txtf, int x, int y) {
		txtf.add(popupBloqueo);
		popupBloqueo.show(txtf, x, y);
		txtf.requestFocus();
		popupBloqueo.setVisible(true);
	}

	protected void setAnchoColumnas() {
		int anchoColumna = 0;
		TableColumnModel modeloColumna = tblPedidos.getColumnModel();
		TableColumn columnaTabla;
		for (int i = 0; i < tblPedidos.getColumnCount(); i++) {
			columnaTabla = modeloColumna.getColumn(i);
			switch (i) {
			case 0:
				anchoColumna = 65;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			case 1:
			case 2:
			case 5:
				anchoColumna = 65;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			case 3:
				anchoColumna = 70;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			case 4:
				anchoColumna = 35;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
			case 6:
				anchoColumna = 200;
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			case 7:
			case 8:
				anchoColumna = 75;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			case 9:
				anchoColumna = 30;
				columnaTabla.setMinWidth(anchoColumna);
				columnaTabla.setMaxWidth(anchoColumna);
				columnaTabla.setPreferredWidth(anchoColumna);
				break;
			}
		}
	}

	protected boolean noHayPedidosMezclados() {
		List<Item> items = mdlTblItems.obtenerTodosItems();
		if (items.isEmpty()) {
			return false;
		} else if (items.size() == 1) {
			return true;
		} else {
			for (int i = 1; i < items.size(); i++) {
				Item it1 = items.get(i);
				Item it2 = items.get(i - 1);
				if ((!it1.getCodigo().isEmpty() && !it2.getCodigo().isEmpty())
						&& it1.getTipoMaterial().compareTo(
								it2.getTipoMaterial()) != 0) {
					return false;
				}
			}
		}
		return true;
	}

	protected void cotizar() {
	}

	protected void guardar() {
		guardarPedidoSQLite();
	}

	protected void btnGuardarOrdenActionPerformed(java.awt.event.ActionEvent evt) {
		if (tblPedidos.getCellEditor() != null) {
			tblPedidos.getCellEditor().stopCellEditing();
		}
		finalizarTransaccion();
	}

	protected void btnConsultaCapturaDinamicaActionPerformed(
			java.awt.event.ActionEvent evt) {
		consultaDinamica();
	}

	protected void btnGuiaVentasActionPerformed(java.awt.event.ActionEvent evt) {
		guiaVentas();
	}

	protected void btnAniadirPedidoActionPerformed(ActionEvent evt) {
		for (int i = 0; i < 12; i++) {
			agregarItemVacio(-1);
		}
		mdlTblItems.actualizarPosiciones();
	}

	public void agregarItemVacio(int pos) {
		Item item = new Item();
		item.setTipoMaterial("");
		item.setCodigo("");
		item.setCantidad("0");
		item.setCantidadConfirmada("0");
		item.setUnidad("");
		item.setPorcentajeDescuento("0.0");
		item.setDenominacion("");
		item.setPrecioNeto(new Double(0d));
		item.setValorNeto(new Double(0d));
		item.setEditable(true);
		item.setTipo(0); // Indica que no hay ning�n item
		item.setSimulado(true);
		mdlTblItems.agregarItem(item, pos);
	}

	protected void enmascararEventoTeclaTab() {
		tblPedidos.getInputMap().put(
				KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), "tab");
		tblPedidos.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT)
				.put(KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), "tab");
		tblPedidos.getInputMap(JComponent.WHEN_FOCUSED).put(
				KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), "tab");
		tblPedidos.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(
				KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), "tab");
		((InputMap) UIManager.get("Table.ancestorInputMap")).put(
				KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), "tab");

		tblPedidos.getActionMap().put("tab", new AbstractAction() {
			public void actionPerformed(ActionEvent e) {
				int fila = tblPedidos.getSelectedRow();
				if (mdlTblItems.esHijo(fila)) {
					int numeroFilas = mdlTblItems.getRowCount();
					if (fila < numeroFilas - 1) {
						fila++;
						selectionModel.setSelectionInterval(fila, fila);
						tblPedidos.editCellAt(fila, 1);
						textFieldCodigo.requestFocusInWindow();
						textFieldCodigo.setEditable(true);
						textFieldCodigo.selectAll();
					}
				}
			}
		});
	}

	protected void establecerOyenteTeclaTab() {
		textFieldCodigo = new JTextField();
		textFieldCantidad = new JTextField();
		textFieldPorcentajeDescuento = new JTextField();

		textFieldCodigo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
		textFieldCantidad.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
		textFieldPorcentajeDescuento.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);

		ValidadorEntradasDeTexto validadorCodigos = new ValidadorEntradasDeTexto(10, Constante.ENTEROS);
		TableColumn columnaCodigo = tblPedidos.getColumnModel().getColumn(1);
		textFieldCodigo.setDocument(validadorCodigos);
		textFieldCodigo.addFocusListener(this);
		textFieldCodigo.setBorder(BorderFactory.createEmptyBorder());
		DefaultCellEditor singleclickCodigo = new DefaultCellEditor(textFieldCodigo);
		singleclickCodigo.setClickCountToStart(1);
		columnaCodigo.setCellEditor(singleclickCodigo);

		ValidadorEntradasDeTexto validadorCantidades = new ValidadorEntradasDeTexto(10, Constante.ENTEROS);
		TableColumn columnaCantidad = tblPedidos.getColumnModel().getColumn(2);
		textFieldCantidad.setDocument(validadorCantidades);
		textFieldCantidad.addFocusListener(this);
		textFieldCantidad.setBorder(BorderFactory.createEmptyBorder());
		DefaultCellEditor singleclickCantidad = new DefaultCellEditor(textFieldCantidad);
		singleclickCantidad.setClickCountToStart(1);
		columnaCantidad.setCellEditor(singleclickCantidad);
		ValidadorEntradasDeTexto validadorPorcentajes = new ValidadorEntradasDeTexto(
				10, Constante.DECIMALES);
		TableColumn columnaPorcentaje = tblPedidos.getColumnModel()
				.getColumn(5);
		textFieldPorcentajeDescuento.setDocument(validadorPorcentajes);
		textFieldPorcentajeDescuento.addFocusListener(this);
		textFieldPorcentajeDescuento.setBorder(BorderFactory
				.createEmptyBorder());
		DefaultCellEditor singleclickPorcentaje = new DefaultCellEditor(
				textFieldPorcentajeDescuento);
		singleclickPorcentaje.setClickCountToStart(1);
		columnaPorcentaje.setCellEditor(singleclickPorcentaje);

		KeyListener keyListenerMaterial = new KeyListener() {
			public void keyPressed(KeyEvent keyEvent) {
				if (keyEvent.getKeyCode() == KeyEvent.VK_TAB || keyEvent.getKeyCode() == KeyEvent.VK_ENTER) {
					// AGREGAMOS UN MATERIAL
					agregarMaterialPorEventoTab();
				}
			}

			public void keyReleased(KeyEvent keyEvent) {
			}

			public void keyTyped(KeyEvent keyEvent) {
			}
		};

		KeyListener keyListenerCantidad = new KeyListener() {
			public void keyPressed(KeyEvent keyEvent) {
				// Agregar Metodo Tab
				int fila = tblPedidos.getSelectedRow();
				if (keyEvent.getKeyCode() == KeyEvent.VK_TAB || keyEvent.getKeyCode() == KeyEvent.VK_ENTER) {
					// AGREGAMOS UN MATERIAL
					String denominacion = (String) mdlTblItems.getValueAt(fila, 6);
					if (denominacion.equals("")) {
						agregarMaterialPorEventoTab01();
					}
				}

				if (keyEvent.getKeyCode() == KeyEvent.VK_TAB) {
					tblPedidos.editCellAt(fila, 5);
					textFieldPorcentajeDescuento.requestFocusInWindow();
					textFieldPorcentajeDescuento.setEditable(true);
					textFieldPorcentajeDescuento.selectAll();
					mdlTblItems.asociarItemsYPrecios();
					mdlTblItems.actualizarEstadoSimulado(fila, false);
					selectionModel.setSelectionInterval(fila, fila);
					tblPedidos.updateUI();
				} else if (keyEvent.getKeyCode() == KeyEvent.VK_ENTER) {
					mdlTblItems.actualizarEstadoSimulado(fila, false);
					tblPedidos.getCellEditor().stopCellEditing();
					mdlTblItems.asociarItemsYPrecios();
					tblPedidos.updateUI();
					simularPreciosMateriales();
					tblPedidos.updateUI();
					establecerCursorPrimeraPosicionLibre();
				}
			}

			public void keyReleased(KeyEvent keyEvent) {
			}

			public void keyTyped(KeyEvent keyEvent) {
			}
		};

		KeyListener keyListenerPorcentaje = new KeyListener() {
			public void keyPressed(KeyEvent keyEvent) {
				int fila = tblPedidos.getSelectedRow();
				int posicionFinal = mdlTblItems.getRowCount() - 1;
				if (keyEvent.getKeyCode() == KeyEvent.VK_TAB) {
					mdlTblItems.actualizarEstadoSimulado(fila, false);
					if (fila < posicionFinal) {
						fila++;
					} else if (fila == posicionFinal) {
						fila = 0;
					}
					selectionModel.setSelectionInterval(fila, fila);
					tblPedidos.editCellAt(fila, 1);
					textFieldCodigo.requestFocusInWindow();
					textFieldCodigo.selectAll();
					textFieldCodigo.setEditable(true);
				} else if (keyEvent.getKeyCode() == KeyEvent.VK_ENTER) {
					mdlTblItems.actualizarEstadoSimulado(fila, false);
					tblPedidos.getCellEditor().stopCellEditing();
					mdlTblItems.asociarItemsYPrecios();
					simularPreciosMateriales();
					tblPedidos.updateUI();
					establecerCursorPrimeraPosicionLibre();
				}
			}

			public void keyReleased(KeyEvent keyEvent) {
			}

			public void keyTyped(KeyEvent keyEvent) {
			}
		};

		textFieldCodigo.addKeyListener(keyListenerMaterial);
		textFieldCantidad.addKeyListener(keyListenerCantidad);
		textFieldPorcentajeDescuento.addKeyListener(keyListenerPorcentaje);
	}

	protected void guiaVentas() {
		final DLocker bloqueador = new DLocker();
		Thread hilo = new Thread() {
			public void run() {
				boolean fallo = false;
				try {
					DHistoricoCliente objHC = null;
					int fila = tblPedidos.getSelectedRow();
					String codigoMaterial = "";
					Item itemSeleccionado = mdlTblItems.obtenerItem(fila);
					if (fila > -1) {
						codigoMaterial = itemSeleccionado.getCodigo().trim();
					}
					objHC = new DHistoricoCliente(instancia, codigoCliente,
							nombreCliente, codigoMaterial);
					objHC.setVisible(true);
				} catch (Exception e) {
					fallo = true;
					Util.mostrarExcepcion(e);
				} finally {
					bloqueador.dispose();
					if (!fallo) {
						if (tblPedidos.getCellEditor() != null) {
							tblPedidos.getCellEditor().stopCellEditing();
						}
					}
				}
			}
		};
		hilo.start();
		bloqueador.setVisible(true);
	}

	protected void simularPreciosMateriales() {
		BeanDato usuario = Promesa.datose.get(0);
		if (usuario.getStrModo().equals("1")) {// DESDE SAP
			simularPreciosDeMaterialesSAP();
		} else {
			simulaPreciosDeMaterialesSQLite2();
		}
	}

	protected void simularPreciosTodosMateriales() {
		if (tblPedidos.getCellEditor() != null) {
			tblPedidos.getCellEditor().stopCellEditing();
		}
		BeanDato usuario = Promesa.datose.get(0);
		lblWarnigs.setText("");
		if (usuario.getStrModo().equals("1")) {// DESDE SAP
			
			simularPreciosDeTodosMaterialesSAP();
		} else {
			flag = true;
			simulaPreciosDeMaterialesSQLite2();
		}
		txtValorNeto.setText("" + Util.formatearNumero(mdlTblItems.getValorNeto()));
	}

	protected void simularPreciosDeTodosMaterialesSAP() {
		final DLocker bloqueador = new DLocker();
		Thread hilo = new Thread() {
			public void run() {
				try {
					BeanDato usuario = Promesa.datose.get(0);
					BeanPedido pedido = llenarEstructuraParaSimulacionTotal();
					if (usuario.getStrModo().equals("1")) {// DESDE SAP
						SPedidos objSAP = new SPedidos();
						try {
							List<String[]> items = objSAP
									.obtenerItemsSimulados(pedido);
							if (items != null && !items.isEmpty()) {
								llenarTabla(items);
							}
						} catch (Exception e) {
							Mensaje.mostrarError(e.getMessage());
							bloqueador.dispose();
							return;
						}
					}
				} catch (Exception e) {
					Util.mostrarExcepcion(e);
				} finally {
					bloqueador.dispose();
					java.awt.EventQueue.invokeLater(new Runnable() {
						public void run() {
							mdlTblItems.asociarItemsYPrecios();
							txtValorNeto.setText(""
									+ Util.formatearNumero(mdlTblItems
											.getValorNeto()));
							bloqueador.dispose();
							tblPedidos.updateUI();
							tblPedidos.clearSelection();
						}
					});
				}
			}
		};
		hilo.start();
		bloqueador.setVisible(true);
	}

	protected BeanMensaje editarPedidoSAP(BeanPedido pedido) {
		BeanMensaje msg = new BeanMensaje("");
		SPedidos objSAP = new SPedidos();
		try {
			String mensaje[] = objSAP.editarOrden(pedido);
			if (mensaje != null) {
				Long codigo = 0l;
				try {
					codigo = Long.parseLong(mensaje[2]);
				} catch (NumberFormatException e) {
					Util.mostrarExcepcion(e);
					codigo = -1l;
				}
				msg.setIdentificador(codigo);
				msg.setDescripcion(mensaje[1]);
				msg.setTipo(mensaje[0]);
			}
		} catch (Exception e) {
			Mensaje.mostrarError(e.getMessage());
		}
		return msg;
	}

	protected BeanMensaje editarPedidoSQLite(BeanPedido pedido) {
		BeanMensaje msg = new BeanMensaje("");
		for (int i = 0; i < pedido.getDetalles().size(); i++) {
			BeanPedidoDetalle detalle = pedido.getDetalles().get(i);
			int posicion = (i + 1) * 10;
			detalle.setPosicion(Util.completarCeros(6, "" + posicion));
		}
		SqlPedidoImpl sqlPedido = new SqlPedidoImpl();
		try {
			String mensaje = sqlPedido.actualizaPedido(pedido);
			if (mensaje != null) {
				Long codigo = 0l;
				try {
					codigo = Long.parseLong(mensaje);
				} catch (NumberFormatException e) {
					Util.mostrarExcepcion(e);
					codigo = -1l;
				}
				msg.setIdentificador(codigo);
				msg.setDescripcion("El pedido se actualizó correctamente.");
				msg.setTipo("N");
			}
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
		}
		return msg;
	}

	protected void establecerCursorPrimeraPosicionLibre() {
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				int numeroFilas = tblPedidos.getRowCount();
				for (int i = 0; i < numeroFilas; i++) {
					String codigo = tblPedidos.getValueAt(i, 1).toString();
					if (codigo.isEmpty()) {
						selectionModel.setSelectionInterval(i, i);
						tblPedidos.editCellAt(i, 1);
						textFieldCodigo.requestFocusInWindow();
						textFieldCodigo.selectAll();
						textFieldCodigo.setEditable(true);
						break;
					}
				}
			}
		});
	}

	protected List<BeanPedido> llenarEstructuraParaCreacionEnSAP() {
		List<Item> materiales = mdlTblItems.obtenerTodosItemsConfirmados();
		if (materiales == null || materiales.isEmpty()) {
			return null;
		}
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		// Segmentamos las �rdenes de acuerdo al tipo de materiales
		List<BeanPedido> pedidos = new ArrayList<BeanPedido>();
		BeanPedidoHeader header = new BeanPedidoHeader();
		BeanPedidoPartners partners = new BeanPedidoPartners();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		java.util.Date fechaActual = new java.util.Date();
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE = tipoDocumento;
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sqlC = new SqlClienteImpl();
		BeanCliente cliente = sqlC.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}
		if ((SALES_ORG == null || SALES_ORG.isEmpty())
				|| (DISTR_CHAN == null || DISTR_CHAN.isEmpty())
				|| (DIVISION == null || DIVISION.isEmpty())) {
			SALES_ORG = cliente.getStrCodOrgVentas();
			DISTR_CHAN = cliente.getStrCodCanalDist();
			DIVISION = cliente.getStrCodSector();
		}

		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		header.setSource(0);
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<BeanPedidoDetalle> materialesBodega = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesNormal = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesPesado = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesRojos = new ArrayList<BeanPedidoDetalle>();
		int fila = 1;
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			SqlMaterial sqlM = new SqlMaterialImpl();
			BeanMaterial bm = sqlM.getMaterial(material);
			if(!mdlTblItems.esHijo(fila) && bm.getPrice_1().equals("0.0")){
				Mensaje.mostrarWarning("El material " + material
						+ " de la posicion " + item.getPosicion()
						+ " tiene Precio Lista = 0.");
				return null;
			}
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			String tipoMaterial = item.getTipoMaterial();
			int tipo = item.getTipo();
			int cantidadPedidaItem = 0;
			try {
				cantidadPedidaItem = Integer.parseInt(item.getCantidad());
			} catch (Exception e) {
				Util.mostrarExcepcion(e);
				cantidadPedidaItem = 0;
			}
			if (cantidadPedidaItem > 0 && (tipo == 0 || tipo == 1)) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle detalle = new BeanPedidoDetalle();
					detalle.setPosicion(posicion);
					detalle.setMaterial(material);
					detalle.setCantidad(cantidad);
					detalle.setCantidadConfirmada(cantidadConfirmada);
					detalle.setUM(um);
					detalle.setPorcentajeDescuento(porcentaje);
					detalle.setDenominacion(denominacion);
					detalle.setPrecioNeto(precioNeto);
					detalle.setValorNeto(valorNeto);
					SqlClienteImpl sql = new SqlClienteImpl();
					String check = sql.obtenerMarcaBloqueoAlmacen(codigoCliente);
					if (tipoMaterial.compareTo("B") == 0 && check.compareTo("1") == 0) { // BODEGA
						materialesBodega.add(detalle);
					} else if (tipoMaterial.compareTo("N") == 0 
							|| (tipoMaterial.compareTo("B") == 0 
							&& check.compareTo("0") == 0)) { // NORMAL
						materialesNormal.add(detalle);
					} else if (tipoMaterial.compareTo("P") == 0) { // PESADO
						materialesPesado.add(detalle);
					} else if (tipoMaterial.compareTo("R") == 0) { // ROJO
						materialesRojos.add(detalle);
					}
				}
			} else if (cantidadPedidaItem <= 0) {
				Mensaje.mostrarWarning("El material " + material
						+ " de la posicion " + posicion
						+ " tiene cantidad = 0.");
				return null;
			}
		}
		BeanPedido pedidoBodega = new BeanPedido();
		BeanPedido pedidoNormal = new BeanPedido();
		BeanPedido pedidoPesado = new BeanPedido();
		BeanPedido pedidoRojo = new BeanPedido();

		pedidoBodega.setTipo("B");
		pedidoNormal.setTipo("N");
		pedidoPesado.setTipo("P");
		pedidoRojo.setTipo("R");

		pedidoBodega.setHeader(header);
		pedidoBodega.setPartners(partners);
		pedidoBodega.setDetalles(materialesBodega);

		pedidoNormal.setHeader(header);
		pedidoNormal.setPartners(partners);
		pedidoNormal.setDetalles(materialesNormal);

		pedidoPesado.setHeader(header);
		pedidoPesado.setPartners(partners);
		pedidoPesado.setDetalles(materialesPesado);

		pedidoRojo.setHeader(header);
		pedidoRojo.setPartners(partners);
		pedidoRojo.setDetalles(materialesRojos);

		pedidos.add(pedidoBodega);
		pedidos.add(pedidoNormal);
		pedidos.add(pedidoPesado);
		pedidos.add(pedidoRojo);
		return pedidos;
	}

	protected List<BeanPedido> llenarEstructuraParaCreacionEnSQLite() {
		List<Item> materiales = mdlTblItems
				.obtenerTodosItemsConfirmadosSQLite();
		if (materiales == null || materiales.isEmpty()) {
			return null;
		}
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		// Segmentamos las �rdenes de acuerdo al tipo de materiales
		List<BeanPedido> pedidos = new ArrayList<BeanPedido>();
		BeanPedidoHeader header = new BeanPedidoHeader();
		BeanPedidoPartners partners = new BeanPedidoPartners();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		java.util.Date fechaActual = new java.util.Date();
		SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE = tipoDocumento;
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sqlC = new SqlClienteImpl();
		BeanCliente cliente = sqlC.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}

		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		header.setStrDocumentoReferencia("");
		header.setStrFechaReferencia("");
		if (source != null) {
			if ((source.compareTo("0") == 0)
					&& usuario.getStrModo().equals("0")) {
				header.setSource(Constante.FROM_SAP_OFFLINE);
			} else {
				header.setSource(Constante.FROM_DB);
			}
		} else {
			header.setSource(Constante.FROM_DB);
		}
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<BeanPedidoDetalle> materialesBodega = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesNormal = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesPesado = new ArrayList<BeanPedidoDetalle>();
		List<BeanPedidoDetalle> materialesRojos = new ArrayList<BeanPedidoDetalle>();

		Double valorNetoBodega = 0d;
		Double valorNetoNormal = 0d;
		Double valorNetoPesado = 0d;
		Double valorNetoRojos = 0d;
		int fila = 1;
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			SqlMaterial sqlM = new SqlMaterialImpl();
			BeanMaterial bm = sqlM.getMaterial(material);
			if(!mdlTblItems.esHijo(fila) && bm.getPrice_1().equals("0.0")){
				Mensaje.mostrarWarning("El material " + material
						+ " de la posicion " + item.getPosicion()
						+ " tiene Precio Lista = 0.");
				return null;
			}
			String cantidad = item.getCantidad();
			Double dCantidad = Double.parseDouble(cantidad);
			cantidad = String.valueOf(dCantidad);
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			String tipoMaterial = item.getTipoMaterial();
			int tipo = item.getTipo();
			int cantidadPedidaItem = 0;
			double vl = 0d;
			try {
				cantidadPedidaItem = Integer.parseInt(item.getCantidad());
			} catch (Exception e) {
				Util.mostrarExcepcion(e);
				cantidadPedidaItem = 0;
			}
			try {
				vl = Double.parseDouble(valorNeto);
			} catch (Exception e) {
				Util.mostrarExcepcion(e);
				vl = 0d;
			}
			// if (cantidadPedidaItem > 0 && (tipo == 0 || tipo == 1)) {
			// if (cantidadPedidaItem > 0 && tipo != 2 ) {
			if (cantidadPedidaItem > 0) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle detalle = new BeanPedidoDetalle();
					detalle.setTipo(tipo);
					detalle.setPosicion(posicion);
					detalle.setMaterial(material);
					detalle.setCantidad(cantidad);
					detalle.setCantidadConfirmada(cantidadConfirmada);
					detalle.setUM(um);
					detalle.setPorcentajeDescuento(porcentaje);
					detalle.setDenominacion(denominacion);
					detalle.setPrecioNeto(precioNeto);
					detalle.setValorNeto(valorNeto);
					SqlClienteImpl sql = new SqlClienteImpl();
					String check = sql
							.obtenerMarcaBloqueoAlmacen(codigoCliente);
					if (tipoMaterial.compareTo("B") == 0
							&& check.compareTo("1") == 0) { // BODEGA
						materialesBodega.add(detalle);
						if (tipo == 0 || tipo == 1) {
							valorNetoBodega += vl;
						}
					} else if (tipoMaterial.compareTo("N") == 0
							|| (tipoMaterial.compareTo("B") == 0 && check
									.compareTo("0") == 0)) { // NORMAL
						materialesNormal.add(detalle);
						if (tipo == 0 || tipo == 1) {
							valorNetoNormal += vl;
						}
					} else if (tipoMaterial.compareTo("P") == 0) { // PESADO
						materialesPesado.add(detalle);
						if (tipo == 0 || tipo == 1) {
							valorNetoPesado += vl;
						}
					} else if (tipoMaterial.compareTo("R") == 0) { // ROJO
						materialesRojos.add(detalle);
						if (tipo == 0 || tipo == 1) {
							valorNetoRojos += vl;
						}
					}
				}
			} else if (cantidadPedidaItem <= 0 && (tipo == 0 || tipo == 1)) {
				Mensaje.mostrarWarning("El material " + material
						+ " de la posicion " + posicion
						+ " tiene cantidad = 0.");
				return null;
			}
			fila ++;
		}
		BeanPedido pedidoBodega = new BeanPedido();
		BeanPedido pedidoNormal = new BeanPedido();
		BeanPedido pedidoPesado = new BeanPedido();
		BeanPedido pedidoRojo = new BeanPedido();

		BeanPedidoHeader hdBodega = (BeanPedidoHeader) header.clone();
		BeanPedidoHeader hdNormal = (BeanPedidoHeader) header.clone();
		BeanPedidoHeader hdPesado = (BeanPedidoHeader) header.clone();
		BeanPedidoHeader hdRojo = (BeanPedidoHeader) header.clone();

		hdBodega.setStrValorNeto("" + valorNetoBodega);
		pedidoBodega.setHeader(hdBodega);
		pedidoBodega.setPartners(partners);
		pedidoBodega.setDetalles(materialesBodega);

		hdNormal.setStrValorNeto("" + valorNetoNormal);
		pedidoNormal.setHeader(hdNormal);
		pedidoNormal.setPartners(partners);
		pedidoNormal.setDetalles(materialesNormal);

		hdPesado.setStrValorNeto("" + valorNetoPesado);
		pedidoPesado.setHeader(hdPesado);
		pedidoPesado.setPartners(partners);
		pedidoPesado.setDetalles(materialesPesado);

		hdRojo.setStrValorNeto("" + valorNetoRojos);
		pedidoRojo.setHeader(hdRojo);
		pedidoRojo.setPartners(partners);
		pedidoRojo.setDetalles(materialesRojos);

		pedidos.add(pedidoBodega);
		pedidos.add(pedidoNormal);
		pedidos.add(pedidoPesado);
		pedidos.add(pedidoRojo);

		return pedidos;
	}

	protected BeanPedido llenarEstructuraParaSimulacionTotal() {
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		BeanPedidoHeader header;
		BeanPedidoPartners partners;
		List<BeanPedidoDetalle> detalles;
		BeanPedido pedido = new BeanPedido();
		pedido = new BeanPedido();
		header = new BeanPedidoHeader();
		partners = new BeanPedidoPartners();
		java.util.Date fechaActual = new java.util.Date();
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(
				"yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE;
		if (tipoDocumento.compareTo("ZO01") == 0) {
			DOC_TYPE = "ZP01";
		} else {
			DOC_TYPE = tipoDocumento;
		}
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sql = new SqlClienteImpl();
		BeanCliente cliente = sql.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}

		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<Item> materiales = mdlTblItems.obtenerTodosItems();
		detalles = new ArrayList<BeanPedidoDetalle>();
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			int tipo = item.getTipo();
			if (tipo == 0 || tipo == 1) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle detalle = new BeanPedidoDetalle();
					detalle.setPosicion(posicion);
					detalle.setMaterial(Util.completarCeros(18, material));
					detalle.setCantidad(cantidad);
					detalle.setCantidadConfirmada(cantidadConfirmada);
					detalle.setUM(um);
					detalle.setPorcentajeDescuento(porcentaje);
					detalle.setDenominacion(denominacion);
					detalle.setPrecioNeto(precioNeto);
					detalle.setValorNeto(valorNeto);
					detalles.add(detalle);
				}
			}
		}
		pedido.setHeader(header);
		pedido.setPartners(partners);
		pedido.setDetalles(detalles);
		return pedido;
	}

	protected BeanPedido llenarEstructuraParaSimulacion() {
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		BeanPedidoHeader header;
		BeanPedidoPartners partners;
		List<BeanPedidoDetalle> detalles;
		BeanPedido pedido = new BeanPedido();
		pedido = new BeanPedido();
		header = new BeanPedidoHeader();
		partners = new BeanPedidoPartners();
		java.util.Date fechaActual = new java.util.Date();
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(
				"yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE;
		if (tipoDocumento.compareTo("ZO01") == 0) {
			DOC_TYPE = "ZP01";
		} else {
			DOC_TYPE = tipoDocumento;
		}
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sql = new SqlClienteImpl();
		BeanCliente cliente = sql.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}

		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<Item> materiales = mdlTblItems.obtenerTodosItemsNoSimulados();
		detalles = new ArrayList<BeanPedidoDetalle>();
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			int tipo = item.getTipo();
			if (tipo == 0 || tipo == 1) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle detalle = new BeanPedidoDetalle();
					detalle.setPosicion(posicion);
					detalle.setMaterial(Util.completarCeros(18, material));
					detalle.setCantidad(cantidad);
					detalle.setCantidadConfirmada(cantidadConfirmada);
					detalle.setUM(um);
					detalle.setPorcentajeDescuento(porcentaje);
					detalle.setDenominacion(denominacion);
					detalle.setPrecioNeto(precioNeto);
					detalle.setValorNeto(valorNeto);
					detalles.add(detalle);
				}
			}
		}
		pedido.setHeader(header);
		pedido.setPartners(partners);
		pedido.setDetalles(detalles);
		return pedido;
	}

	protected BeanPedido llenarEstructuraParaGuardarSQLite() {
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		BeanPedidoHeader header;
		BeanPedidoPartners partners;
		List<BeanPedidoDetalle> detalles;
		BeanPedido pedido = new BeanPedido();
		pedido = new BeanPedido();
		header = new BeanPedidoHeader();
		partners = new BeanPedidoPartners();
		pedido.setCodigoPedido(txtCodigoPedido.getText());
		Date fechaActual = new Date();
		SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE = tipoDocumento;
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sql = new SqlClienteImpl();
		BeanCliente cliente = sql.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}
		if ((SALES_ORG == null || SALES_ORG.isEmpty())
				|| (DISTR_CHAN == null || DISTR_CHAN.isEmpty())
				|| (DIVISION == null || DIVISION.isEmpty())) {
			SALES_ORG = cliente.getStrCodOrgVentas();
			DISTR_CHAN = cliente.getStrCodCanalDist();
			DIVISION = cliente.getStrCodSector();
		}
		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		if ((source.compareTo("0") == 0 && usuario.getStrModo().equals("0"))
				|| source.compareTo("2") == 0) {
			header.setSource(Constante.FROM_SAP_OFFLINE);
		} else {
			header.setSource(Constante.FROM_DB);
		}
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));

		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<Item> materiales = mdlTblItems.obtenerTodosItems();
		detalles = new ArrayList<BeanPedidoDetalle>();
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			String cantidadAMostrar = "" + item.getCantidadAMostrar();
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			int tipo = item.getTipo();
			if (!item.getCodigo().trim().isEmpty()) {
				BeanPedidoDetalle detalle = new BeanPedidoDetalle();
				detalle.setPosicion(posicion);
				detalle.setMaterial(Util.completarCeros(18, material));
				detalle.setCantidad(cantidad);
				if (tipo == 2) {
					detalle.setCantidad(cantidadAMostrar);
				}
				detalle.setCantidadConfirmada(cantidadConfirmada);
				detalle.setUM(um);
				detalle.setPorcentajeDescuento(porcentaje);
				detalle.setDenominacion(denominacion);
				detalle.setPrecioNeto(precioNeto);
				detalle.setValorNeto(valorNeto);
				detalle.setTipo(tipo);
				detalles.add(detalle);
			}
		}
		pedido.setHeader(header);
		pedido.setPartners(partners);
		pedido.setDetalles(detalles);
		return pedido;
	}

	protected BeanPedido llenarEstructuraParaGuardarCotizacion() {
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		BeanPedidoHeader header;
		BeanPedidoPartners partners;
		List<BeanPedidoDetalle> detalles;
		BeanPedido pedido = new BeanPedido();
		pedido = new BeanPedido();
		header = new BeanPedidoHeader();
		partners = new BeanPedidoPartners();
		pedido.setCodigoPedido(txtCodigoPedido.getText());
		java.util.Date fechaActual = new java.util.Date();
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(
				"yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE = tipoDocumento;
		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sql = new SqlClienteImpl();
		BeanCliente cliente = sql.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}
		if ((SALES_ORG == null || SALES_ORG.isEmpty())
				|| (DISTR_CHAN == null || DISTR_CHAN.isEmpty())
				|| (DIVISION == null || DIVISION.isEmpty())) {
			SALES_ORG = cliente.getStrCodOrgVentas();
			DISTR_CHAN = cliente.getStrCodCanalDist();
			DIVISION = cliente.getStrCodSector();
		}
		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<Item> materiales = mdlTblItems.obtenerTodosItems();
		detalles = new ArrayList<BeanPedidoDetalle>();
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			int tipo = item.getTipo();
			if (tipo == 0 || tipo == 1) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle d = new BeanPedidoDetalle();
					d.setPosicion(posicion);
					String codMat = Util.completarCeros(18, material);
					d.setMaterial(codMat);
					d.setCantidad(cantidad);
					d.setCantidadConfirmada(cantidadConfirmada);
					d.setUM(um);
					d.setPorcentajeDescuento(porcentaje);
					d.setDenominacion(denominacion);
					d.setPrecioNeto(precioNeto);
					d.setValorNeto(valorNeto);
					d.setTipo(tipo);
					detalles.add(d);
				}
			}
		}
		pedido.setHeader(header);
		pedido.setPartners(partners);
		pedido.setDetalles(detalles);
		return pedido;
	}

	protected BeanPedido llenarEstructuraParaGuardarActualizacion() {
		BeanDato usuario = Promesa.datose.get(0);
		BeanCondicionExpedicion ce = (BeanCondicionExpedicion) cmbCondExped
				.getSelectedItem();
		String SHIP_COND = ce.getStrIdCondicionExpedicion();
		BeanPedidoHeader header;
		BeanPedidoPartners partners;
		List<BeanPedidoDetalle> detalles;
		BeanPedido pedido = new BeanPedido();
		pedido = new BeanPedido();
		header = new BeanPedidoHeader();
		partners = new BeanPedidoPartners();
		pedido.setCodigoPedido(txtCodigoPedido.getText());
		java.util.Date fechaActual = new java.util.Date();
		java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("yyyyMMdd");
		String fecha = sdf.format(fechaActual);
		String bloqueoEntrega = txtBloqEntrega.getText();
		String DOC_TYPE = tipoDocumento;

		String SALES_ORG = organizacionVentas;
		String DISTR_CHAN = canalDistribucion;
		String DIVISION = codigoSector;

		String SALES_GRP = "";
		String SALES_OFF = "";

		SqlClienteImpl sql = new SqlClienteImpl();
		BeanCliente cliente = sql.buscarCliente(codigoCliente);

		if (cliente != null) {
			SALES_GRP = cliente.getStrGrupoVentas();
			SALES_OFF = cliente.getStrOficinaVentas();
		}
		if ((SALES_ORG == null || SALES_ORG.isEmpty())
				|| (DISTR_CHAN == null || DISTR_CHAN.isEmpty())
				|| (DIVISION == null || DIVISION.isEmpty())) {
			SALES_ORG = cliente.getStrCodOrgVentas();
			DISTR_CHAN = cliente.getStrCodCanalDist();
			DIVISION = cliente.getStrCodSector();
		}
		String date = fecha;
		@SuppressWarnings("unused")
		String REQ_DATE_H = date;
		String PURCH_DATE = date;
		String PMNTTRMS = condicionPago;
		String DLV_BLOCK = bloqueoEntrega;
		String PRICE_DATE = date;
		String PURCH_NO_C = txtNPedCliente.getText();
		String SD_DOC_CAT = "C";
		String DOC_DATE = date;
		String BILL_DATE = date;
		String SERV_DATE = date;
		String CURRENCY = "USD";
		BeanConexion cn = new BeanConexion();
		String CREATED_BY = cn.getStrUsuarioSAP();
		String SHIP_TYPE = "01";
		header.setDOC_TYPE(DOC_TYPE);
		header.setSALES_ORG(SALES_ORG);
		header.setDISTR_CHAN(DISTR_CHAN);
		header.setDIVISION(DIVISION);
		header.setSALES_GRP(SALES_GRP);
		header.setSALES_OFF(SALES_OFF);
		header.setREQ_DATE_H(date);
		header.setPURCH_DATE(PURCH_DATE);
		header.setPMNTTRMS(PMNTTRMS);
		header.setDLV_BLOCK(DLV_BLOCK);
		header.setPRICE_DATE(PRICE_DATE);
		header.setPURCH_NO_C(PURCH_NO_C);
		header.setSD_DOC_CAT(SD_DOC_CAT);
		header.setDOC_DATE(DOC_DATE);
		header.setBILL_DATE(BILL_DATE);
		header.setSERV_DATE(SERV_DATE);
		header.setCURRENCY(CURRENCY);
		header.setCREATED_BY(CREATED_BY);
		header.setSHIP_TYPE(SHIP_TYPE);
		header.setSHIP_COND(SHIP_COND);
		header.setStrValorNeto(txtValorNeto.getText());
		header.setStrCodCliente(codigoCliente);
		header.setStrCliente(nombreCliente);
		header.setStrCodVendedor(usuario.getStrCodigo());
		header.setTxtClaseRiesgo(txtClasRiesgo.getText());
		header.setTxtDisponible(txtDisponible.getText());
		header.setTxtLimiteCredito(txtLimCredito.getText().replaceAll(",", ""));
		/**
		 * PARTNERS
		 */
		HashMap<String, String> hm = new HashMap<String, String>();
		hm.put("AG", Util.completarCeros(10, codigoCliente));
		hm.put("WE", Util.completarCeros(10, txtDestinatario.getText()));
		hm.put("ZS", Util.obtenerCodigoSupervisor());
		hm.put("ZV", Util.completarCeros(10, usuario.getStrCodigo()));
		partners.setHm(hm);
		/*
		 * MATERIALES
		 */
		List<Item> materiales = mdlTblItems.obtenerTodosItems();
		detalles = new ArrayList<BeanPedidoDetalle>();
		int i = 0;
		for (Item item : materiales) {
			String posicion = item.getPosicion();
			String material = item.getCodigo();
			String cantidad = item.getCantidad();
			String cantidadConfirmada = item.getCantidadConfirmada();
			String um = item.getUnidad();
			String porcentaje = item.getPorcentajeDescuento();
			String denominacion = item.getDenominacion();
			String precioNeto = "" + item.getPrecioNeto();
			String valorNeto = "" + item.getValorNeto();
			int tipo = item.getTipo();
			// Marcelo Moyano
			if (i == 0 && material.equals("")) {
				return null;
			}
			i++;
			if (tipo == 0 || tipo == 1) {
				if (!item.getCodigo().trim().isEmpty()) {
					BeanPedidoDetalle detalle = new BeanPedidoDetalle();
					detalle.setPosicion(posicion);
					detalle.setMaterial(Util.completarCeros(18, material));
					detalle.setCantidad(cantidad);
					if (item.isEliminadoLogicamente()) {
						detalle.setMotivoRechazo("19");
					} else {
						detalle.setMotivoRechazo("");
					}
					detalle.setCantidadConfirmada(cantidadConfirmada);
					detalle.setUM(um);
					detalle.setPorcentajeDescuento(porcentaje);
					detalle.setDenominacion(denominacion);
					detalle.setPrecioNeto(precioNeto);
					detalle.setValorNeto(valorNeto);
					detalle.setTipo(tipo);
					detalles.add(detalle);
				}
			}
		}
		pedido.setCodigoPedido(txtCodigoPedido.getText());
		pedido.setHeader(header);
		pedido.setPartners(partners);
		pedido.setDetalles(detalles);
		return pedido;
	}

	protected void simulaPreciosDeMaterialesSQLite2() {
		final DLocker bloqueador = new DLocker();
		Thread hilo = new Thread() {
			public void run() {
				try {
					List<Item> lista;
					if (flag) {
						flag = false;
						lista = mdlTblItems.obtenerTodosItems();
					} else {
						lista = mdlTblItems.obtenerTodosItemsNoSimulados();// Marcelo
																			// Moyano
																			// 28/11/2014
					}
					String codCliente = codigoCliente;
					String codCondPago = txtCondPago.getText();
					SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();

					Double dblCantidadPedido = new Double(0);
					Double dblImportePedido = new Double(0);

					List<BeanMaterial> listaMaterialesGrilla = new ArrayList<BeanMaterial>();
					// se limpian los % y clases de condicion entre cada
					// simulaciòn
					for (Item item : lista) {
						item.setDblDesc1(new Double(0));
						item.setDblDesc2(new Double(0));
						item.setDblDesc3(new Double(0));
						item.setDblDesc4(new Double(0));
						item.setDblDesc5(new Double(0));
						item.setStrCondCalc1("");
						item.setStrCondCalc2("");
						item.setStrCondCalc3("");
						item.setStrCondCalc4("");
						item.setStrCondCalc5("");
						listaMaterialesGrilla.add(sqlMateriales
								.getMaterial(item.getCodigo()));
					}
					SqlClienteImpl sqlCliente = new SqlClienteImpl();
					BeanCliente beanCliente = sqlCliente
							.buscarCliente(codCliente);

					// ///CONDICIONES COMERCIALES 1X
					for (Item i : lista) {
						i.setSimulado(true);
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanMaterial beanMaterial = null;
							beanMaterial = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							i.setPrecioBase(Double.parseDouble(beanMaterial
									.getPrice_1()));
							/*
							 * PRECIO CLIENTE MATERIAL --- PRECIO COMBO
							 */
							if (i.getTipo() == 2) {
								double importeCombo = sqlMateriales.ObtenerPrecioMaterialXCliente("",
												i.getCodigo());
								if (importeCombo != 0d) {
									i.setPrecioBase(importeCombo);
								} else {
									double importePrecioClienteMaterial = sqlMateriales
											.ObtenerPrecioMaterialXCliente(codCliente, i.getCodigo());
									if (importePrecioClienteMaterial != 0d) {
										i.setPrecioBase(importePrecioClienteMaterial);
									}
								}
							} else {
								double importePrecioClienteMaterial = sqlMateriales
										.ObtenerPrecioMaterialXCliente(codCliente, i.getCodigo());
								if (importePrecioClienteMaterial != 0d) {
									i.setPrecioBase(importePrecioClienteMaterial);
								}
							}
							/***/
							List<BeanClaseMaterial> listaClasesMaterial = sqlMateriales
									.obtenerClaseMaterial(i.getCodigo());
							BeanCondicionComercial1 b1 = new BeanCondicionComercial1();
							b1.setStrCondicionPago(codCondPago);
							b1.setStrCliente(codCliente);
							b1.setListaStrClaseMaterial(listaClasesMaterial);
							Double dblDscto = new Double("0");
							List<BeanCondicionComercial1> listaCondiciones1 = sqlMateriales
									.listarCondicion1(b1);
							BeanCondicionComercial1 beanCondicion1 = null;
							if (listaCondiciones1 != null
									&& listaCondiciones1.size() == 1) {
								beanCondicion1 = listaCondiciones1.get(0);
								dblDscto = beanCondicion1.getDblImporte() / 10;
								i.setDblDesc1(dblDscto);
								i.setStrCondCalc1(beanCondicion1
										.getStrClaseCond());
								i.setStrNroCond1(beanCondicion1
										.getStrNroRegCond());
							} else {
								i.setDblDesc1(new Double(0));
								i.setStrCondCalc1("");
								i.setStrNroCond1("");
							}
						}
					}
					// ///CONDICIONES COMERCIALES 1X

					// ///CONDICIONES COMERCIALES 2X
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial2 b2 = new BeanCondicionComercial2();
							b2.setStrCliente(codCliente);
							b2.setStrGrupoCliente(""
									+ Integer.parseInt(beanCliente
											.getStrCodigoTipologia()));
							b2.setStrCanal(beanCliente.getStrCodCanalDist());
							List<BeanCondicionComercial2> listaCondiciones2 = sqlMateriales
									.listarCondicion2(b2);
							Double dblDscto = new Double("0");
							BeanCondicionComercial2 beanCondicion2 = null;
							if (listaCondiciones2 != null
									&& listaCondiciones2.size() == 1) {
								beanCondicion2 = listaCondiciones2.get(0);
								dblDscto = beanCondicion2.getDblImporte() / 10;
								i.setDblDesc2(dblDscto);
								i.setStrCondCalc2(beanCondicion2
										.getStrClaseCond());
								i.setStrNroCond2(beanCondicion2
										.getStrNroRegCond());
							} else {
								i.setDblDesc2(new Double(0));
								i.setStrCondCalc2("");
								i.setStrNroCond2("");
							}
							int intSolicitado = (int) Double.parseDouble(i
									.getCantidad());
							// Nelson Villegas-Verificar stock
							// int intStock = (int)
							// Double.parseDouble(beanMaterial.getSt_1());
							String cantidadMaterialStock = sqlMateriales
									.obtenerStockMaterial(i.getCodigo());
							if (cantidadMaterialStock.length() == 0) {
								cantidadMaterialStock = "0";
							}
							int intStock = (int) Double
									.parseDouble(cantidadMaterialStock);
							// Nelson Villegas-Verificar stock
							// int intNuevoStock = 0;
							int intConfirmado = 0;
							if (intSolicitado <= intStock) {
								intConfirmado = intSolicitado;
							} else {
								intConfirmado = intStock;
							}
							i.setCantidadConfirmada(String
									.valueOf(intConfirmado));
						}
					}
					// ///CONDICIONES COMERCIALES 2X

					// ///CONDICIONES COMERCIALES 3X
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
							// cliente
							b3.setStrCliente(codCliente);
							BeanMaterial objMat = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							List<BeanClaseMaterial> listClaMat = sqlMateriales
									.obtenerClaseMaterial(i.getCodigo());
							if (listClaMat != null && listClaMat.size() == 1) {
								// clase material
								b3.setStrClase(listClaMat.get(0)
										.getStrDescripcionClaseMaterial());
							} else {
								String strClaseMaterialTemp = "";
								for (BeanClaseMaterial beanClaseMaterial : listClaMat) {
									strClaseMaterialTemp += beanClaseMaterial
											.getStrDescripcionClaseMaterial()
											+ "','";
								}
								b3.setStrClase(strClaseMaterialTemp);
							}
							// jerarquia
							b3.setStrDivisionCom(objMat.getPrdha().substring(0,
									2) != null ? objMat.getPrdha().substring(2,
									5) : "");
							b3.setStrCatProd(objMat.getPrdha().substring(2, 5) != null ? objMat
									.getPrdha().substring(2, 5) : "");
							b3.setStrFamilia(objMat.getPrdha().substring(5, 9) != null ? objMat
									.getPrdha().substring(2, 5) : "");
							b3.setStrLinea(objMat.getPrdha().substring(9, 13) != null ? objMat
									.getPrdha().substring(2, 5) : "");
							b3.setStrGrupo(objMat.getPrdha().substring(13, 18) != null ? objMat
									.getPrdha().substring(2, 5) : "");
							// material
							b3.setStrMaterial(i.getCodigo());
							// división
							BeanCliente objCliente = sqlCliente
									.buscarCliente(codCliente);
							b3.setStrDivisionC(objCliente.getStrGrupoVentas());
							BeanCondicionComercial3x beanCondicion3 = null;
							Double dblDscto = new Double("0");
							List<BeanCondicionComercial3x> listaCondiciones3x = sqlMateriales
									.listarCondicion3(b3);
							// se calcula el importe del pedido, considerando
							// los % de descuento que se aplicaron
							// en 1x y 2x de todos los items
							if (listaCondiciones3x != null
									&& listaCondiciones3x.size() == 1) {
								beanCondicion3 = listaCondiciones3x.get(0);
								i.setStrCondCalc3(beanCondicion3
										.getStrClaseCond());
								i.setDblDesc3(dblDscto);
								i.setStrNroCond3(beanCondicion3
										.getStrNroRegCond());
							} else {
								i.setDblDesc3(new Double(0));
								i.setStrCondCalc3("");
								i.setStrNroCond3("");
							}
						}
					}
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
							// cliente
							b3.setStrCliente(codCliente);
							BeanMaterial objMat = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							List<BeanClaseMaterial> listClaMat = sqlMateriales
									.obtenerClaseMaterial(i.getCodigo());
							if (listClaMat != null && listClaMat.size() == 1) {
								// clase material
								b3.setStrClase(listClaMat.get(0)
										.getStrDescripcionClaseMaterial());
							} else {
								String strClaseMaterialTemp = "";
								for (BeanClaseMaterial beanClaseMaterial : listClaMat) {
									strClaseMaterialTemp += beanClaseMaterial
											.getStrDescripcionClaseMaterial()
											+ "','";
								}
								b3.setStrClase(strClaseMaterialTemp);
							}
							// jerarquia
							b3.setStrDivisionCom(objMat.getPrdha().substring(0,
									2));
							b3.setStrCatProd(objMat.getPrdha().substring(2, 5));
							b3.setStrFamilia(objMat.getPrdha().substring(5, 9));
							b3.setStrLinea(objMat.getPrdha().substring(9, 13));
							b3.setStrGrupo(objMat.getPrdha().substring(13, 18));
							// material
							b3.setStrMaterial(i.getCodigo());
							// división
							BeanCliente objCliente = sqlCliente
									.buscarCliente(codCliente);
							b3.setStrDivisionC(objCliente.getStrGrupoVentas());
							BeanCondicionComercial3x beanCondicion3 = null;
							Double dblDscto = new Double("0");
							List<BeanCondicionComercial3x> listaCondiciones3x = sqlMateriales
									.listarCondicion3(b3);
							// se calcula el importe del pedido, considerando
							// los % de descuento que se aplicaron
							// en 1x y 2x de todos los items
							dblImportePedido = calculaImportePedidoClaseCondicion1x2x2(
									lista, i, listaMaterialesGrilla);

							if (listaCondiciones3x != null
									&& listaCondiciones3x.size() == 1) {
								beanCondicion3 = listaCondiciones3x.get(0);
								if (beanCondicion3.getStrEscala().equals("X")) {
									dblDscto = beanCondicion3
											.getDblImporteEscala(dblImportePedido) / 10;
								} else {
									dblDscto = beanCondicion3.getDblImporte() / 10;
								}
								i.setStrCondCalc3(beanCondicion3
										.getStrClaseCond());
								i.setDblDesc3(dblDscto);
								i.setStrNroCond3(beanCondicion3
										.getStrNroRegCond());
							} else {
								i.setDblDesc3(new Double(0));
								i.setStrCondCalc3("");
								i.setStrNroCond3("");
							}
						}
					}
					// ///CONDICIONES COMERCIALES 3X

					// ///CONDICIONES COMERCIALES 4X
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
							// cliente
							b3.setStrCliente(codCliente);
							BeanMaterial objMat = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							List<BeanClaseMaterial> listClaMat = sqlMateriales
									.obtenerClaseMaterial(i.getCodigo());
							if (listClaMat != null && listClaMat.size() == 1) {
								// clase material
								b3.setStrClase(listClaMat.get(0)
										.getStrDescripcionClaseMaterial());
							} else {
								String strClaseMaterialTemp = "";
								for (BeanClaseMaterial beanClaseMaterial : listClaMat) {
									strClaseMaterialTemp += beanClaseMaterial
											.getStrDescripcionClaseMaterial()
											+ "','";
								}
								b3.setStrClase(strClaseMaterialTemp);
							}
							// jerarquia
							b3.setStrDivisionCom(objMat.getPrdha().substring(0,
									2));
							b3.setStrCatProd(objMat.getPrdha().substring(2, 5));
							b3.setStrFamilia(objMat.getPrdha().substring(5, 9));
							b3.setStrLinea(objMat.getPrdha().substring(9, 13));
							b3.setStrGrupo(objMat.getPrdha().substring(13, 18));
							// material
							b3.setStrMaterial(i.getCodigo());
							// división
							BeanCliente objCliente = sqlCliente
									.buscarCliente(codCliente);
							b3.setStrDivisionC(objCliente.getStrGrupoVentas());
							BeanCondicionComercial4x beanCondicion4 = null;
							List<BeanCondicionComercial4x> listaCondiciones4x = sqlMateriales
									.listarCondicion4(b3);
							dblCantidadPedido = calculaCantidadPedidoClaseCondicion2(
									lista, i);
							System.out.println("-->" + dblCantidadPedido);
							if (listaCondiciones4x != null
									&& listaCondiciones4x.size() == 1) {
								beanCondicion4 = listaCondiciones4x.get(0);
								i.setStrCondCalc4(beanCondicion4
										.getStrClaseCond());
								i.setStrNroCond4(beanCondicion4
										.getStrNroRegCond());
							} else {
								i.setStrCondCalc4("");
								i.setStrNroCond4("");
							}
						}
					}
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
							// cliente
							b3.setStrCliente(codCliente);
							BeanMaterial objMat = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							List<BeanClaseMaterial> listClaMat = sqlMateriales
									.obtenerClaseMaterial(i.getCodigo());
							if (listClaMat != null && listClaMat.size() == 1) {
								// clase material
								b3.setStrClase(listClaMat.get(0)
										.getStrDescripcionClaseMaterial());
							} else {
								String strClaseMaterialTemp = "";
								for (BeanClaseMaterial beanClaseMaterial : listClaMat) {
									strClaseMaterialTemp += beanClaseMaterial
											.getStrDescripcionClaseMaterial()
											+ "','";
								}
								b3.setStrClase(strClaseMaterialTemp);
							}
							// jerarquia
							b3.setStrDivisionCom(objMat.getPrdha().substring(0,
									2));
							b3.setStrCatProd(objMat.getPrdha().substring(2, 5));
							b3.setStrFamilia(objMat.getPrdha().substring(5, 9));
							b3.setStrLinea(objMat.getPrdha().substring(9, 13));
							b3.setStrGrupo(objMat.getPrdha().substring(13, 18));
							// material
							b3.setStrMaterial(i.getCodigo());
							// división
							BeanCliente objCliente = sqlCliente
									.buscarCliente(codCliente);
							b3.setStrDivisionC(objCliente.getStrGrupoVentas());
							Double dblDscto = new Double("0");
							BeanCondicionComercial4x beanCondicion4 = null;
							List<BeanCondicionComercial4x> listaCondiciones4x = sqlMateriales
									.listarCondicion4(b3);

							dblCantidadPedido = calculaCantidadPedidoClaseCondicion2(
									lista, i);
							System.out.println("-->" + dblCantidadPedido);
							if (listaCondiciones4x != null
									&& listaCondiciones4x.size() == 1) {
								beanCondicion4 = listaCondiciones4x.get(0);
								if (beanCondicion4.getStrEscala().equals("X")) {
									dblDscto = beanCondicion4
											.getDblImporteEscala(dblCantidadPedido) / 10;
								} else {
									dblDscto = beanCondicion4.getDblImporte() / 10;
								}
								i.setDblDesc4(dblDscto);
								i.setStrCondCalc4(beanCondicion4
										.getStrClaseCond());
							} else {
								i.setDblDesc4(new Double(0));
								i.setStrCondCalc4("");
							}
						}
					}
					// ///CONDICIONES COMERCIALES 4X

					// ///CONDICIONES COMERCIALES 5X
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							BeanCondicionComercial5x beanCondicion5 = null;
							Double dblDscto = new Double("0");
							BeanCondicionComercial5x b5 = new BeanCondicionComercial5x();
							b5.setStrCliente(codCliente);
							BeanMaterial objMat = obtenerMaterialDeGrilla(
									listaMaterialesGrilla, i.getCodigo());
							b5.setStrDivisionCom(objMat.getPrdha().substring(0,
									2));
							b5.setStrCatProd(objMat.getPrdha().substring(2, 5));
							b5.setStrFamilia(objMat.getPrdha().substring(5, 9));
							List<BeanCondicionComercial5x> listaCondiciones5x = sqlMateriales
									.listarCondicion5(b5);
							dblCantidadPedido = calculaImportePedido4x2(lista,
									i, listaMaterialesGrilla);

							if (listaCondiciones5x != null
									&& listaCondiciones5x.size() == 1) {
								beanCondicion5 = listaCondiciones5x.get(0);
								if (beanCondicion5.getStrEscala().equals("X")) {
									dblDscto = beanCondicion5
											.getDblImporteEscala(dblCantidadPedido) / 10;
								} else {
									dblDscto = beanCondicion5.getDblImporte() / 10;
								}
								i.setDblDesc5(dblDscto);
								i.setStrCondCalc5(beanCondicion5
										.getStrClaseCond());
								i.setStrNroCond5(beanCondicion5
										.getStrNroRegCond());
							} else {
								i.setDblDesc5(new Double(0));
								i.setStrCondCalc5("");
								i.setStrNroCond5("");
							}
						}
					}
					// ///CONDICIONES COMERCIALES 5X
					String strDescCalc = "";
					for (Item i : lista) {
						if (i.getCodigo() != null
								&& !i.getCodigo().trim().equals("")
								&& (i.getTipo() == 0 || i.getTipo() == 2)) {
							Double dblPrecioFinal = new Double(0);
							strDescCalc += "precio bruto del material "
									+ i.getCodigo() + ": " + i.getPrecioBase();
							strDescCalc += "\n";
							Double dblPrecioTemp = i.getPrecioBase();
							if (i.getDblDesc1() != null
									&& i.getStrCondCalc1() != null
									&& !i.getStrCondCalc1().equals("")) {
								dblPrecioTemp = dblPrecioTemp
										* (100 + i.getDblDesc1()) / 100;
								strDescCalc += " primer descuento :"
										+ i.getStrCondCalc1() + " / "
										+ i.getDblDesc1();
								strDescCalc += " precio final :"
										+ Integer.parseInt(i
												.getCantidadConfirmada())
										* dblPrecioTemp;
								strDescCalc += "\n";
							}
							if (i.getDblDesc2() != null
									&& i.getStrCondCalc2() != null
									&& !i.getStrCondCalc2().equals("")) {
								dblPrecioTemp = dblPrecioTemp
										* (100 + i.getDblDesc2()) / 100;
								strDescCalc += " segundo descuento :"
										+ i.getStrCondCalc2() + " / "
										+ i.getDblDesc2();
								strDescCalc += " precio final :"
										+ Integer.parseInt(i
												.getCantidadConfirmada())
										* dblPrecioTemp;
								strDescCalc += "\n";
							}
							if (i.getDblDesc3() != null
									&& i.getStrCondCalc3() != null
									&& !i.getStrCondCalc3().equals("")) {
								dblPrecioTemp = dblPrecioTemp
										* (100 + i.getDblDesc3()) / 100;
								strDescCalc += " tercer descuento :"
										+ i.getStrCondCalc3() + " / "
										+ i.getDblDesc3();
								strDescCalc += " precio final :"
										+ Integer.parseInt(i
												.getCantidadConfirmada())
										* dblPrecioTemp;
								strDescCalc += "\n";
							}
							if (i.getDblDesc4() != null
									&& i.getStrCondCalc4() != null
									&& !i.getStrCondCalc4().equals("")) {
								dblPrecioTemp = dblPrecioTemp
										* (100 + i.getDblDesc4()) / 100;
								strDescCalc += " cuarto descuento :"
										+ i.getStrCondCalc4() + " / "
										+ i.getDblDesc4();
								strDescCalc += " precio final :"
										+ Integer.parseInt(i
												.getCantidadConfirmada())
										* dblPrecioTemp;
								strDescCalc += "\n";
							}
							if (i.getDblDesc5() != null
									&& i.getStrCondCalc5() != null
									&& !i.getStrCondCalc5().equals("")) {
								dblPrecioTemp = dblPrecioTemp
										* (100 + i.getDblDesc5()) / 100;
								strDescCalc += " quinto descuento :"
										+ i.getStrCondCalc5() + " / "
										+ i.getDblDesc5();
								strDescCalc += " precio final :"
										+ Integer.parseInt(i
												.getCantidadConfirmada())
										* dblPrecioTemp;
								strDescCalc += "\n";
							}
							String valor = i.getPorcentajeDescuento();
							if (valor.equals("")) {
								valor = "0.00";
							}
							Double dblDsctoManual = Double.parseDouble(valor);
							dblPrecioTemp = dblPrecioTemp
									* (100 - Math.abs(dblDsctoManual)) / 100;

							dblPrecioFinal = dblPrecioTemp;
							double d = dblPrecioFinal
									* Integer.parseInt(i
											.getCantidadConfirmada());
							i.setValorNeto((d * 1000) / 1000.0d);
							i.setPrecioNeto(dblPrecioFinal);
							i.setSimulado(true);

							// Marcelo Moyano
							// ExameptionViewer.getInstance().limpiar();
							// ExceptionViewer.getInstance().setStackTrace(strDescCalc);
							// ExceptionViewer.getInstance().hacerVisible();
							// Marcelo Moyano
							// Aparece Pila de Errores
							String codigo= i.getCodigo();
							System.out.println("Mat:" + codigo);
							
							String condCalc1 = i.getStrCondCalc1();
							double dblDesc1 = i.getDblDesc1();
							System.out.println("Dscto 1:" + condCalc1 + " " + dblDesc1);
							
							String condCalc2 = i.getStrCondCalc2();
							double dblDesc2 = i.getDblDesc2();
							System.out.println("Dscto 2:" +condCalc2+ " " + dblDesc2);
							
							String condCalc3 = i.getStrCondCalc3();
							double dblDesc3 = i.getDblDesc3();
							System.out.println("Dscto 3:" + condCalc3+ " " +dblDesc3);
							
							String condCalc4 = i.getStrCondCalc4();
							double dblDesc4 = i.getDblDesc4();
							System.out.println("Dscto 4:" +condCalc4+ " " + dblDesc4);
							
							String condCalc5 = i.getStrCondCalc5();
							double dblDesc5 = i.getDblDesc5();
							System.out.println("Dscto 5:" + condCalc5+ " " + dblDesc5);
						}
					}
					mdlTblItems.asociarItemsYPrecios();
					
					String valorNeto = mdlTblItems.getValorNeto().toString();
					String treDigitos = Util.formatearNumeroTresDigitos(valorNeto);
					txtValorNeto.setText(treDigitos);
					tblPedidos.updateUI();
				} catch (Exception e) {
					Util.mostrarExcepcion(e);
				} finally {
					bloqueador.dispose();
					java.awt.EventQueue.invokeLater(new Runnable() {
						public void run() {
							mdlTblItems.asociarItemsYPrecios();
							String valorNeto = mdlTblItems.getValorNeto().toString();
							txtValorNeto.setText(Util.formatearNumero(valorNeto));
							bloqueador.dispose();
							tblPedidos.updateUI();
							tblPedidos.clearSelection();
						}
					});
				}
			}
		};
		hilo.start();
		bloqueador.setVisible(true);
	}

	protected void simularPreciosDeMaterialesSAP() {
		final DLocker bloqueador = new DLocker();
		Thread hilo = new Thread() {
			public void run() {
				try {
					BeanDato usuario = Promesa.datose.get(0);
					List<Item> simulados = mdlTblItems.obtenerTodosItemsSimulados();
					BeanPedido pedido = llenarEstructuraParaSimulacion();
					if (usuario.getStrModo().equals("1")) {// DESDE SAP
						SPedidos objSAP = new SPedidos();
						try {
							List<String[]> items = objSAP
									.obtenerItemsSimulados(pedido);
							if (items != null && !items.isEmpty()) {
								llenarTabla(items, simulados);
							}
						} catch (Exception e) {
							Mensaje.mostrarError(e.getMessage());
							bloqueador.dispose();
							return;
						}
					}
				} catch (Exception e) {
					Util.mostrarExcepcion(e);
				} finally {
					bloqueador.dispose();
					java.awt.EventQueue.invokeLater(new Runnable() {
						public void run() {
							mdlTblItems.asociarItemsYPrecios();
							String valorNeto = mdlTblItems.getValorNeto().toString();
							txtValorNeto.setText(""+ Util.formatearNumero(valorNeto));
							bloqueador.dispose();
							tblPedidos.updateUI();
							tblPedidos.clearSelection();
						}
					});
				}
			}
		};
		hilo.start();
		bloqueador.setVisible(true);
	}

	protected List<BeanMensaje> guardarPedidoSQLite() {
		List<BeanMensaje> mensajes = new ArrayList<BeanMensaje>();
		List<BeanPedido> pedidos = llenarEstructuraParaCreacionEnSQLite();
		if (pedidos == null) {
			return null;
		}
		for (BeanPedido pedido : pedidos) {
			if (!pedido.getDetalles().isEmpty()) {
				try {
					for (int i = 0; i < pedido.getDetalles().size(); i++) {
						BeanPedidoDetalle detalle = pedido.getDetalles().get(i);
						int posicion = (i + 1) * 10;
						detalle.setPosicion(Util.completarCeros(6, ""+ posicion));
					}
					pedido.setCodigoPedido("");
					String mensaje[] = guardarPedidoSQLite(pedido);
					if (mensaje != null) {
						BeanMensaje msg = new BeanMensaje("");
						Long codigo = 0l;
						try {
							codigo = Long.parseLong(mensaje[2]);
						} catch (NumberFormatException e) {
							Util.mostrarExcepcion(e);
							codigo = -1l;
						}
						msg.setIdentificador(codigo);
						msg.setDescripcion(mensaje[1]);
						msg.setTipo(mensaje[0]);
						mensajes.add(msg);
					}
				} catch (Exception e) {
					Util.mostrarExcepcion(e);
				}
			}
		}
		return mensajes;
	}

	protected List<BeanMensaje> guardarPedidoSAP() {
		List<BeanMensaje> mensajes = new ArrayList<BeanMensaje>();
		List<BeanPedido> pedidos = llenarEstructuraParaCreacionEnSAP();
		mapaItems = new HashMap<String, List<Item>>();
		List<Item> its = mdlTblItems.obtenerTodosItems();
		List<Item> itsNormal = new ArrayList<Item>();
		List<Item> itsRojo = new ArrayList<Item>();
		List<Item> itsPesado = new ArrayList<Item>();
		List<Item> itsBodega = new ArrayList<Item>();

		for (Item item : its) {
			if (item.getTipo() == 0 || item.getTipo() == 1) {
				if (item.getTipoMaterial().toUpperCase().compareTo("N") == 0) {
					itsNormal.add(item);
				} else if (item.getTipoMaterial().toUpperCase().compareTo("R") == 0) {
					itsRojo.add(item);
				} else if (item.getTipoMaterial().toUpperCase().compareTo("B") == 0) {
					itsBodega.add(item);
				} else if (item.getTipoMaterial().toUpperCase().compareTo("P") == 0) {
					itsPesado.add(item);
				}
			}
		}
		mapaItems.put("N", itsNormal);
		mapaItems.put("R", itsRojo);
		mapaItems.put("B", itsBodega);
		mapaItems.put("P", itsPesado);
		if (pedidos == null) {
			return null;
		}
		for (BeanPedido pedido : pedidos) {
			SPedidos objSAP = new SPedidos();
//			BeanDato user = Promesa.datose.get(0);
//			if (user.getStrModo().equals("0")) {
//				return null;
//			}
			if (!pedido.getDetalles().isEmpty()) {
				try {
					for (int i = 0; i < pedido.getDetalles().size(); i++) {
						BeanPedidoDetalle detalle = pedido.getDetalles().get(i);
						int posicion = (i + 1) * 10;
						detalle.setPosicion(Util.completarCeros(6, ""
								+ posicion));
					}
					String mensaje[] = objSAP.guardarPedido(pedido);
					if (mensaje != null) {
						BeanMensaje msg = new BeanMensaje("");
						Long codigo = 0l;
						try {
							codigo = Long.parseLong(mensaje[2]);
							if(codigo < 0){
								msg.setPedido(pedido);
								msg.setIts(mapaItems.get(pedido.getTipo()));
							}
						} catch (NumberFormatException e) {
							codigo = -1l;
							msg.setPedido(pedido);
							msg.setIts(mapaItems.get(pedido.getTipo()));
						}
						msg.setIdentificador(codigo);
						msg.setDescripcion(mensaje[1]);
						msg.setTipo(mensaje[0]);
						msg.setTipoMaterial(pedido.getTipo());
						mensajes.add(msg);
					}
				} catch (Exception e) {
					Mensaje.mostrarError(e.getMessage());
				}
			}
		}
		return mensajes;
	}

	protected List<BeanMensaje> cotizarPedidoSAP() {
		List<BeanMensaje> mensajes = new ArrayList<BeanMensaje>();
		BeanPedido pedido = llenarEstructuraParaGuardarCotizacion();
		if (pedido == null) {
			System.out.println("Pedido nulo.");
			return null;
		}
		SPedidos objSAP = new SPedidos();
		if (!pedido.getDetalles().isEmpty()) {
			try {
				String mensaje[] = objSAP.crearCotizacion(pedido);
				if (mensaje != null) {
					BeanMensaje msg = new BeanMensaje("");
					Long codigo = 0l;
					try {
						codigo = Long.parseLong(mensaje[2]);
					} catch (NumberFormatException e) {
						Util.mostrarExcepcion(e);
						codigo = -1l;
					}
					msg.setIdentificador(codigo);
					msg.setDescripcion(mensaje[1]);
					msg.setTipo(mensaje[0]);
					mensajes.add(msg);
				}
			} catch (Exception e) {
				Mensaje.mostrarError(e.getMessage());
			}
		}
		return mensajes;
	}

	protected String[] guardarPedidoSQLite(BeanPedido pedido) {
		BeanMensaje mensaje = new BeanMensaje("");
		boolean fallo = false;
		String idBD = "0";
		String msj = "";
		long codigo = 0;
		try {
			SqlPedidoImpl pedidosSQL = new SqlPedidoImpl();
			idBD = pedidosSQL.insertarPedidos(pedido);
			try {
				codigo = Long.parseLong(idBD);
			} catch (Exception e) {
				codigo = 0l;
				Util.mostrarExcepcion(e);
			}
			switch (tipoVentana) {
			case Constante.VENTANA_CREAR_PEDIDO:
				msj = "El pedido N° "
						+ codigo
						+ " se ha guardado correctamente en base de datos local.";
				break;

			case Constante.VENTANA_CREAR_PROFORMA:
				msj = "La proforma N° "
						+ codigo
						+ " se ha guardado correctamente en base de datos local.";
				break;
			case Constante.VENTANA_CREAR_COTIZACION:
				msj = "La cotización N° "
						+ codigo
						+ " se ha guardado correctamente en base de datos local.";
				break;
			}
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
			fallo = true;
			mensaje.setDescripcion("No se ha podido guardar correctamente el pedido porque: \n"
					+ e.getMessage());
			mensaje.setIdentificador(0l);
			mensaje.setTipo("E");

		} finally {
			if (!fallo) {
				mensaje.setDescripcion(msj);
				mensaje.setIdentificador(codigo);
				mensaje.setTipo("N");
			}
		}
		String[] msg = new String[3];
		msg[0] = mensaje.getTipo();
		msg[1] = mensaje.getDescripcion();
		msg[2] = "" + mensaje.getIdentificador();
		return msg;
	}

	protected void llenarTabla(final List<String[]> items) {
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				SqlMaterialImpl sql = new SqlMaterialImpl();
				for (String[] strings : items) {
					Item item = new Item();
					@SuppressWarnings("unused")
					int pos = 0;
					try {
						pos = Integer.parseInt(strings[0]);
					} catch (Exception e) {
						pos = 0;
					}
					item.setPosicion(strings[0]);
					item.setCodigo(strings[1]);
					item.setCantidad(strings[2]);
					item.setCantidadConfirmada(strings[3]);
					item.setUnidad(strings[4]);
					item.setDenominacion(strings[6]);
					iva = strings[10]; // GUARDA VALOR IVA
					Double precioNeto = 0d;
					try {
						precioNeto = Double.parseDouble(strings[7]);
						// precioNeto =
						// Double.parseDouble(Util.formatearNumeroTresDigitos(strings[7]));
					} catch (Exception e) {
						Util.mostrarExcepcion(e);
						precioNeto = 0d;
					}

					Double valorNeto = 0d;
					try {
						valorNeto = Double.parseDouble(strings[8]);
					} catch (Exception e) {
						Util.mostrarExcepcion(e);
						valorNeto = 0d;
					}

					item.setEditable(true);
					item.setPrecioNeto(precioNeto);
					item.setValorNeto(valorNeto);
					String categoria = strings[9];
					item.setTipoSAP(categoria);
					if (categoria.compareTo("ZP01") == 0) {
						item.setTipo(0);
					} else if (categoria.compareTo("ZPP1") == 0) {
						item.setTipo(1);
					} else if (categoria.compareTo("ZPH1") == 0) {
						int k = 0;
						try {
							k = Integer.parseInt(strings[2]);
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						item.setCantidadAMostrar(k);
						item.setTipo(2);
						item.setEditable(false);
					}
					item.setTipoMaterial(sql.getTipoMaterial(item.getCodigo()));
					item.setSimulado(true);
					final Item it = item;
					mdlTblItems.actualizarItem(it);
				}
				mdlTblItems.asociarItemsYPrecios();
				List<Item> items = mdlTblItems.obtenerTodosItems();
				for (Item i : items) {
					if (i.getTipo() == 2) {
						int cantidad = 0;
						int cantidadPadre = 0;
						try {
							cantidad = Integer.parseInt(i.getCantidad());
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						try {
							cantidadPadre = Integer.parseInt(i.getPadre()
									.getCantidad());
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						if (cantidadPadre != 0) {
							cantidad /= cantidadPadre;
							i.setCantidad("" + cantidad);
						}
					}
				}
			}
		});
	}

	protected void llenarTabla(final List<String[]> items,
			final List<Item> itemsSimulados) {
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				SqlMaterialImpl sql = new SqlMaterialImpl();
				for (String[] strings : items) {
					Item item = new Item();
					@SuppressWarnings("unused")
					int pos = 0;
					try {
						pos = Integer.parseInt(strings[0]);
					} catch (Exception e) {
						Util.mostrarExcepcion(e);
						pos = 0;
					}
					item.setPosicion(strings[0]);
					item.setCodigo(strings[1]);
					item.setCantidad(strings[2]);
					item.setCantidadConfirmada(strings[3]);
					item.setUnidad(strings[4]);
					item.setDenominacion(strings[6]);
					iva = strings[10]; // GUARDA VALOR IVA
					Double precioNeto = 0d;
					try {
						precioNeto = Double.parseDouble(strings[7]);
						// precioNeto =
						// Double.parseDouble(Util.formatearNumeroTresDigitos(strings[7]));
					} catch (Exception e) {
						Util.mostrarExcepcion(e);
						precioNeto = 0d;
					}
					Double valorNeto = 0d;
					try {
						valorNeto = Double.parseDouble(strings[8]);
					} catch (Exception e) {
						Util.mostrarExcepcion(e);
						valorNeto = 0d;
					}
					item.setEditable(true);
					item.setPrecioNeto(precioNeto);
					item.setValorNeto(valorNeto);
					String categoria = strings[9];
					item.setTipoSAP(categoria);
					if (categoria.compareTo("ZP01") == 0) {
						item.setTipo(0);
					} else if (categoria.compareTo("ZPP1") == 0) {
						item.setTipo(1);
					} else if (categoria.compareTo("ZPH1") == 0) {
						int k = 0;
						try {
							k = Integer.parseInt(strings[2]);
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						item.setCantidadAMostrar(k);
						item.setTipo(2);
						item.setEditable(false);
					}
					item.setTipoMaterial(sql.getTipoMaterial(item.getCodigo()));
					item.setSimulado(true);
					final Item it = item;
					mdlTblItems.actualizarItem(it);
				}
				mdlTblItems.asociarItemsYPrecios();
				List<Item> items = mdlTblItems.obtenerTodosItems();
				for (Item i : items) {
					if (i.getTipo() == 2) {
						int cantidad = 0;
						int cantidadPadre = 0;
						try {
							cantidad = Integer.parseInt(i.getCantidad());
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						try {
							cantidadPadre = (int) Double.parseDouble(i
									.getPadre().getCantidad());
						} catch (Exception e) {
							Util.mostrarExcepcion(e);
						}
						if (cantidadPadre != 0) {
							cantidad /= cantidadPadre;
							i.setCantidad("" + cantidad);
						}
					}
				}
			}
		});
	}

	protected void agregarMaterialPorEventoTab() {
		int fila = tblPedidos.getSelectedRow();
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		SqlComboImpl sqlCombos = new SqlComboImpl();
		String codigo = textFieldCodigo.getText();
		if (!mdlTblItems.yaEstaAgregado(codigo, fila)) {
			BeanMaterial mat = sqlMateriales.getMaterial(codigo);
			boolean vacio = false;
			if (mat != null) {
				Item material = new Item();
				material.setDenominacion(sqlMateriales
						.obtenerNombreMaterial(codigo));
				material.setPosicion(mdlTblItems.getValueAt(fila, 0).toString());
				material.setCodigo(textFieldCodigo.getText());
				material.setUnidad(mat.getUn());
				material.setCantidad(mdlTblItems.getValueAt(fila, 2).toString());
				material.setCantidadConfirmada(mdlTblItems.getValueAt(fila, 3)
						.toString());
				material.setPorcentajeDescuento(mdlTblItems.getValueAt(fila, 5)
						.toString());
				material.setPrecioNeto(mdlTblItems.obtenerItem(fila)
						.getPrecioNeto());
				material.setValorNeto(mdlTblItems.obtenerItem(fila)
						.getValorNeto());
				material.setTipo(0); // Item normal
				material.setEditable(true);

				String tipoMaterial = mat.getTypeMat();
				SqlClienteImpl sql = new SqlClienteImpl();
				String check = sql.obtenerMarcaBloqueoAlmacen(codigoCliente);
				if (tipoMaterial.compareTo("B") == 0 && check.compareTo("1") == 0) { // BODEGA
					tipoMaterial = "B";
				} else if (tipoMaterial.compareTo("N") == 0 || (tipoMaterial.compareTo("B") == 0 && check.compareTo("0") == 0)) { // NORMAL
					tipoMaterial = "N";
				} else if (tipoMaterial.compareTo("P") == 0) { // PESADO
					tipoMaterial = "P";
				} else if (tipoMaterial.compareTo("R") == 0) { // ROJO
					tipoMaterial = "R";
				}
				material.setTipoMaterial(tipoMaterial);
				material.setSimulado(false);
				mdlTblItems.agregarItem(material, fila);
				tblPedidos.updateUI();
			} else {
				Item combo = sqlCombos.getCombo(codigo);
				if (combo != null) {
					if (!mdlTblItems.existeCombo(codigo)) {
						combo.setCantidad("1");
						combo.setCantidadConfirmada(mdlTblItems.getValueAt(
								fila, 3).toString());
						combo.setPorcentajeDescuento(mdlTblItems.getValueAt(
								fila, 5).toString());
						combo.setEditable(true);
						combo.setSimulado(true);
						mdlTblItems.agregarItem(combo, fila);
						tblPedidos.updateUI();
					}
				} else {
					vacio = true;
				}
			}
			if (vacio) {
				lblMensajes.setBorder(javax.swing.BorderFactory
						.createEmptyBorder(1, 10, 1, 1));
				lblMensajes
						.setText("<html><font color='red'>EL MATERIAL SELECCIONADO NO EXISTE</font></html>");
				textFieldCodigo.selectAll();
			} else {
				lblMensajes.setText("");
				actualizarPosiciones();
				tblPedidos.editCellAt(fila, 2);
				textFieldCantidad.requestFocusInWindow();
				textFieldCantidad.setEditable(true);
				selectionModel.setSelectionInterval(fila, fila);
			}
		} else {
			tblPedidos.editCellAt(fila, 1);
			textFieldCodigo.requestFocusInWindow();
			textFieldCodigo.selectAll();
			textFieldCodigo.setEditable(true);
		}
	}

	public void actualizarPosiciones() {
		mdlTblItems.actualizarPosiciones();
	}

	public int agregarMaterial(Item item, int posicion) {
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		BeanMaterial mat = sqlMateriales.getMaterial(item.getCodigo());
		if (mat != null) {
			String tipoMaterial = mat.getTypeMat();
			SqlClienteImpl sql = new SqlClienteImpl();
			String check = sql.obtenerMarcaBloqueoAlmacen(codigoCliente);
			if (tipoMaterial.compareTo("B") == 0 && check.compareTo("1") == 0) { // BODEGA
				tipoMaterial = "B";
			} else if (tipoMaterial.compareTo("N") == 0
					|| (tipoMaterial.compareTo("B") == 0 && check
							.compareTo("0") == 0)) { // NORMAL
				tipoMaterial = "N";
			} else if (tipoMaterial.compareTo("P") == 0) { // PESADO
				tipoMaterial = "P";
			} else if (tipoMaterial.compareTo("R") == 0) { // ROJO
				tipoMaterial = "R";
			}
			item.setTipoMaterial(tipoMaterial);
			/*
			 * marcelo moyano
			 */
			Integer k = 0;
			try {
				k = Integer.parseInt(item.getCantidad());
			} catch (Exception ex) {
				k = 0;
			}// ---- Marcelo Moyano ---- //
				// Integer k = Integer.parseInt(item.getCantidad());
			int opcion = mdlTblItems.yaEstaAgregadoDeConsultaDinamica(
					item.getCodigo(), k);
			switch (opcion) {
			case -2:
				return -1;
			case -1:
				mdlTblItems.agregarItem(item, posicion);
				tblPedidos.updateUI();
				return 1;
			default:
				mdlTblItems.agregarItem(item, opcion);
				tblPedidos.updateUI();
				return 1;
			}
		}
		return -1;
	}

	@Override
	public void focusGained(FocusEvent arg0) {
		if (arg0.getSource() == textFieldCodigo) {
			textFieldCodigo.selectAll();
		} else if (arg0.getSource() == textFieldCantidad) {
			textFieldCantidad.selectAll();
		} else if (arg0.getSource() == textFieldPorcentajeDescuento) {
			textFieldPorcentajeDescuento.selectAll();
		}
	}

	@Override
	public void focusLost(FocusEvent arg0) {
	}

	public void setTitulo(String titulo) {
		lblTitulo.setText(titulo);
	}

	public String getCodigoCliente() {
		return codigoCliente;
	}

	public void setCodigoCliente(String codigoCliente) {
		this.codigoCliente = codigoCliente;
	}

	public String getBloqueoEntrega() {
		return bloqueoEntrega;
	}

	public void setBloqueoEntrega(String bloqueoEntrega) {
		this.bloqueoEntrega = bloqueoEntrega;
	}

	public String getNumeroPedidoCliente() {
		return numeroPedidoCliente;
	}

	public void setNumeroPedidoCliente(String numeroPedidoCliente) {
		this.numeroPedidoCliente = numeroPedidoCliente;
		txtNPedCliente.setText(numeroPedidoCliente);
	}

	public BeanCondicionExpedicion getCondicionExpedicion() {
		return (BeanCondicionExpedicion) cmbCondExped.getSelectedItem();
	}

	public String getDestinatario() {
		return txtDestinatario.getText();
	}

	public String getNombreCliente() {
		return nombreCliente;
	}

	public void setNombreCliente(String nombreCliente) {
		this.nombreCliente = nombreCliente;
	}

	public String getClaseRiesgo() {
		return claseRiesgo;
	}

	public void setClaseRiesgo(String claseRiesgo) {
		this.claseRiesgo = claseRiesgo;
	}

	public String getDisponibilidad() {
		return disponibilidad;
	}

	public void setDisponibilidad(String disponibilidad) {
		this.disponibilidad = disponibilidad;
	}

	public String getLimiteCredito() {
		return limiteCredito;
	}

	public void setLimiteCredito(String limiteCredito) {
		this.limiteCredito = limiteCredito;
	}

	public String getCondicionPago() {
		return condicionPago;
	}

	public void setCondicionPago(String condicionPago) {
		this.condicionPago = condicionPago;
	}

	public String getOrganizacionVentas() {
		return organizacionVentas;
	}

	public void setOrganizacionVentas(String organizacionVentas) {
		this.organizacionVentas = organizacionVentas;
	}

	public String getCanalDistribucion() {
		return canalDistribucion;
	}

	public void setCanalDistribucion(String canalDistribucion) {
		this.canalDistribucion = canalDistribucion;
	}

	public String getCodigoSector() {
		return codigoSector;
	}

	public void setCodigoSector(String codigoSector) {
		this.codigoSector = codigoSector;
	}

	public void setCondicionExpedicion(String condicionExpedicion) {
		this.condicionExpedicion = condicionExpedicion;
	}

	public String getTipoDocumento() {
		return tipoDocumento;
	}

	public void setTipoDocumento(String tipoDocumento) {
		this.tipoDocumento = tipoDocumento;
	}

	public void internalFrameClosing(InternalFrameEvent e) {
		cerrar();
	}

	public void internalFrameClosed(InternalFrameEvent e) {
	}

	public void internalFrameOpened(InternalFrameEvent e) {
	}

	public void internalFrameIconified(InternalFrameEvent e) {
	}

	public void internalFrameDeiconified(InternalFrameEvent e) {
	}

	public void internalFrameActivated(InternalFrameEvent e) {
	}

	public void internalFrameDeactivated(InternalFrameEvent e) {
	}

	protected void imprimir(String titutlo) {
		boolean estaSincronizado = false;
		if (source.compareTo("0") == 0) {
			estaSincronizado = true;
		}
		BeanDato usuario = Promesa.datose.get(0);
		TicketOrden ticket = new TicketOrden(titutlo);
		ticket.setDireccion(Util.obtenerDireccionPromesa());
		ticket.setTelefono(Util.obtenerTelefonoPromesa());
		int cod = 0;
		try {
			cod = Integer.parseInt(codigoCliente);
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
			cod = 0;
		}
		ticket.setCodigoCliente("" + cod);
		ticket.setCliente(cod + "-" + nombreCliente);
		ticket.setDireccionCliente(direccionDestinatario);
		try {
			cod = Integer.parseInt(usuario.getStrCodigo());
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
			cod = 0;
		}
		ticket.setVendedor(cod + "-" + usuario.getStrUsuario());
		ticket.setFecha(Util.convierteFechaAFormatoDDMMMYYYY(new Date()));
		ticket.setCondicionesPago(descripcionCondicionPago);
		ticket.setNumeroPedido(txtCodigoPedido.getText());
		List<DetalleTicketOrden> detalles = new ArrayList<DetalleTicketOrden>();
		List<Item> items = mdlTblItems.obtenerTodosItems();
		// llenar items
		for (Item item : items) {
			String material = item.getCodigo();
			int cantidad = 0;
			double precio = 0d;
			double valor = 0d;
			try {
				cantidad = (int) Double.parseDouble(item.getCantidad());
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				cantidad = 0;
			}
			try {
				precio = item.getPrecioNeto();
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				precio = 0d;
			}
			try {
				valor = item.getValorNeto();
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				valor = 0d;
			}
			if (!material.isEmpty()) {
				DetalleTicketOrden detalle = new DetalleTicketOrden(material,
						item.getDenominacion(), item.getTipo(), cantidad,
						precio, valor);
				detalles.add(detalle);
			}
		}
		// ------------
		ticket.setDetalles(detalles);
		ReporteTicket reporte = new ReporteTicket(ticket, estaSincronizado);
		reporte.generarReportePedido();
	}

	protected void imprimirDPP350(String titulo) {
		@SuppressWarnings("unused")
		boolean estaSincronizado = false;
		if (source.compareTo("0") == 0) {
			estaSincronizado = true;
		}
		BeanDato usuario = Promesa.datose.get(0);
		ReportePedido ticket = new ReportePedido();
		ticket.setTitulo(titulo);
		ticket.setDireccion(Util.obtenerDireccionPromesa());
		ticket.setTelefono(Util.obtenerTelefonoPromesa());
		int cod = 0;
		try {
			cod = Integer.parseInt(codigoCliente);
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
			cod = 0;
		}
		ticket.setCodigoCliente("" + cod);
		ticket.setCliente(cod + "-" + nombreCliente);
		ticket.setDireccionCliente(direccionDestinatario);
		try {
			cod = Integer.parseInt(usuario.getStrCodigo());
		} catch (Exception e) {
			Util.mostrarExcepcion(e);
			cod = 0;
		}
		ticket.setVendedor(cod + "-" + usuario.getStrUsuario());
		ticket.setFecha(Util.convierteFechaAFormatoDDMMMYYYY(new Date()));
		ticket.setCondicionesPago(descripcionCondicionPago);
		ticket.setNumeroPedido(txtCodigoPedido.getText());
		List<DetalleTicketOrden> detalles = new ArrayList<DetalleTicketOrden>();
		List<Item> items = mdlTblItems.obtenerTodosItems();
		// llenar items
		for (Item item : items) {
			String material = item.getCodigo();
			int cantidad = 0;
			double precio = 0d;
			double valor = 0d;
			try {
				cantidad = (int) Double.parseDouble(item.getCantidad());
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				cantidad = 0;
			}
			try {
				precio = Double.parseDouble(Util.formatearNumero(item
						.getPrecioNeto()));
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				precio = 0d;
			}
			try {
				valor = Double.parseDouble(Util.formatearNumero(item
						.getValorNeto()));
			} catch (NumberFormatException e) {
				Util.mostrarExcepcion(e);
				valor = 0d;
			}
			if (!material.isEmpty()) {
				DetalleTicketOrden detalle = new DetalleTicketOrden(material,
						item.getDenominacion(), item.getTipo(), cantidad,
						precio, valor);
				detalles.add(detalle);
			}
		}
		ticket.setTotal(Double.parseDouble(txtValorNeto.getText()));
		ticket.setDetalles(detalles);
		ticket.imprimir();
	}

	protected void btnEliminarPedidoActionPerformed(ActionEvent evt) {
		if (tblPedidos.getCellEditor() != null) {
			tblPedidos.getCellEditor().stopCellEditing();
		}
		int fila = tblPedidos.getSelectedRow();
		if (fila > -1) {
			mdlTblItems.borrarItem(fila);
			tblPedidos.updateUI();
			txtValorNeto.setText(""
					+ Util.formatearNumero(mdlTblItems.getValorNeto()));
		} else {
			JOptionPane.showMessageDialog(null,
					"Por favor seleccione un item de la tabla.", "Mensaje",
					JOptionPane.WARNING_MESSAGE);
		}
	}

	protected BeanCliente obtenerCliente(String codigo) {
		BeanCliente cliente = null;
		SqlClienteImpl sql = new SqlClienteImpl();
		cliente = sql.buscarCliente(codigo);
		return cliente;
	}

	protected void consultaDinamica() {
		final DLocker bloqueador = new DLocker();
		Thread hilo = new Thread() {
			public void run() {
				DConsultaMateriales2 dlgConsulta = null;
				boolean fallo = false;
				try {
					BeanCliente cliente = obtenerCliente(codigoCliente);
					BeanAgenda agenda = new BeanAgenda();
					agenda.setStrCodigoCliente(codigoCliente);
					agenda.setStrNombreCliente(nombreCliente);
					cliente.setStrCondicionPagoDefecto(condicionPago);
					if (cliente != null) {
						dlgConsulta = new DConsultaMateriales2(Promesa.datose,
								cliente, instancia, Promesa.getInstance(),
								true, agenda, txtCondPago.getText());
					}
				} catch (Exception ex) {
					fallo = true;
					Util.mostrarExcepcion(ex);
				} finally {
					bloqueador.dispose();
					if (!fallo) {
						if (tblPedidos.getCellEditor() != null) {
							tblPedidos.getCellEditor().stopCellEditing();
						}
						dlgConsulta.setVisible(true);
					}
				}
			}
		};
		hilo.start();
		bloqueador.setVisible(true);
	}

	protected abstract void finalizarTransaccion();

	protected void cerrar() {
		if (editable) {
			int tipo = JOptionPane.showConfirmDialog(this,
					"¿Desea cerrar la ventana?", "Confirmación",
					JOptionPane.YES_NO_OPTION);
			if (tipo == JOptionPane.OK_OPTION) {
				this.dispose();
			}
		} else {
			this.dispose();
		}
	}

	private Double calculaCantidadPedidoClaseCondicion(List<Item> listaItem,
			Item i) {
		double dblRetorno = 0;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")
					&& item.getCantidad() != null
					&& !item.getCantidad().equals("")
					&& item.getStrCondCalc4() != null
					&& i.getStrCondCalc4() != null
					&& item.getStrCondCalc4().equals(i.getStrCondCalc4())) {
				try {
					dblRetorno += Double.parseDouble(item.getCantidad());
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	private Double calculaCantidadPedidoClaseCondicion2(List<Item> listaItem,
			Item i) {
		double dblRetorno = 0;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				System.out.println("..." + item.getStrCondCalc4() + " - "
						+ i.getStrCondCalc4());
			}
			if (item.getCodigo() != null
					&& !item.getCodigo().equals("")
					&& item.getCantidad() != null
					&& !item.getCantidad().equals("")
					&& item.getStrCondCalc4() != null
					&& i.getStrCondCalc4() != null
					&& item.getStrCondCalc4().equals(i.getStrCondCalc4())
					&& item.getStrNroCond4() != null
					&& i.getStrNroCond4() != null
					&& item.getStrNroCond4().trim()
							.equals(i.getStrNroCond4().trim())) {
				try {
					dblRetorno += Double.parseDouble(item.getCantidad());
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	@SuppressWarnings("unused")
	private Double calculaImportePedidoClaseCondicion1x2x(List<Item> listaItem,
			Item i) {
		double dblRetorno = 0;
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		Double dblCantidad = null;
		Double dblPrecio = null;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				dblCantidad = new Double(0);
				BeanMaterial beanMaterial = null;
				beanMaterial = sqlMateriales.getMaterial(item.getCodigo());
				if (beanMaterial != null && beanMaterial.getPrice_1() != null) {
					/*
					 * agregado para calcular el importe considerando los
					 * descuentos anteriores
					 */
					Double dblPrecioTemp = new Double(beanMaterial.getPrice_1());
					if (item.getDblDesc1() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc1()) / 100;
					}
					if (item.getDblDesc2() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc2()) / 100;
					}

					dblPrecio = dblPrecioTemp;
				}
				if (item.getCantidad() != null
						&& !item.getCantidad().equals("")) {
					dblCantidad = new Double(item.getCantidad());
				}
				try {
					dblRetorno += (dblCantidad.doubleValue() * dblPrecio
							.doubleValue());
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	private Double calculaImportePedidoClaseCondicion1x2x2(
			List<Item> listaItem, Item i,
			List<BeanMaterial> listaMaterialesGrilla) {
		double dblRetorno = 0;
		Double dblCantidad = null;
		Double dblPrecio = null;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				dblCantidad = new Double(0);
				BeanMaterial beanMaterial = obtenerMaterialDeGrilla(
						listaMaterialesGrilla, item.getCodigo());
				if (beanMaterial != null && beanMaterial.getPrice_1() != null) {
					/*
					 * agregado para calcular el importe considerando los
					 * descuentos anteriores
					 */
					// Double dblPrecioTemp = new
					// Double(beanMaterial.getPrice_1());
					Double dblPrecioTemp = new Double(item.getPrecioBase());
					if (item.getDblDesc1() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc1()) / 100;
					}
					if (item.getDblDesc2() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc2()) / 100;
					}
					dblPrecio = dblPrecioTemp;
				}
				if (item.getCantidad() != null
						&& !item.getCantidad().equals("")) {
					dblCantidad = new Double(item.getCantidad());
				}
				if (item.getCodigo() != null
						&& !item.getCodigo().equals("")
						&& item.getCantidad() != null
						&& !item.getCantidad().equals("")
						&& item.getStrCondCalc3() != null
						&& i.getStrCondCalc3() != null
						&& item.getStrCondCalc3().equals(i.getStrCondCalc3())
						&& item.getStrNroCond3() != null
						&& i.getStrNroCond3() != null
						&& item.getStrNroCond3().trim()
								.equals(i.getStrNroCond3().trim())) {
					try {
						dblRetorno += (dblCantidad.doubleValue() * dblPrecio
								.doubleValue());
					} catch (Exception e) {
					}
				}
			}
		}
		return new Double(dblRetorno);
	}

	private Double calculaImportePedidoClaseCondicion3x(List<Item> listaItem,
			Item i) {
		double dblRetorno = 0;
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		Double dblCantidad = null;
		Double dblPrecio = null;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				dblCantidad = new Double(0);
				BeanMaterial beanMaterial = null;
				beanMaterial = sqlMateriales.getMaterial(item.getCodigo());
				if (beanMaterial != null && beanMaterial.getPrice_1() != null) {
					/*
					 * agregado para calcular el importe considerando los
					 * descuentos anteriores
					 */
					Double dblPrecioTemp = new Double(beanMaterial.getPrice_1());
					if (item.getDblDesc1() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc1()) / 100;
					}
					if (item.getDblDesc2() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc2()) / 100;
					}
					if (item.getDblDesc3() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc3()) / 100;
					}
					dblPrecio = dblPrecioTemp;
				}
				if (item.getCantidad() != null
						&& !item.getCantidad().equals("")) {
					dblCantidad = new Double(item.getCantidad());
				}

				try {
					dblRetorno += (dblCantidad.doubleValue() * dblPrecio
							.doubleValue());
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	@SuppressWarnings("unused")
	private Double calculaImportePedido4x(List<Item> listaItem, Item i) {
		double dblRetorno = 0;
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		Double dblCantidad = null;
		Double dblPrecio = null;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				dblCantidad = new Double(0);
				BeanMaterial beanMaterial = null;
				beanMaterial = sqlMateriales.getMaterial(item.getCodigo());
				if (beanMaterial != null && beanMaterial.getPrice_1() != null) {
					/*
					 * agregado para calcular el importe considerando los
					 * descuentos anteriores
					 */
					Double dblPrecioTemp = new Double(beanMaterial.getPrice_1());
					if (item.getDblDesc1() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc1()) / 100;
					}
					if (item.getDblDesc2() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc2()) / 100;
					}
					if (item.getDblDesc3() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc3()) / 100;
					}
					if (item.getDblDesc4() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc4()) / 100;
					}
					dblPrecio = dblPrecioTemp;
				}

				if (item.getCantidad() != null
						&& !item.getCantidad().equals("")) {
					dblCantidad = new Double(item.getCantidad());
				}
				try {
					dblRetorno += dblCantidad.doubleValue()
							* dblPrecio.doubleValue();
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	private Double calculaImportePedido4x2(List<Item> listaItem, Item i,
			List<BeanMaterial> listaMaterialesGrilla) {
		double dblRetorno = 0;
		Double dblCantidad = null;
		Double dblPrecio = null;
		for (Item item : listaItem) {
			if (item.getCodigo() != null && !item.getCodigo().equals("")) {
				dblCantidad = new Double(0);
				BeanMaterial beanMaterial = null;
				beanMaterial = obtenerMaterialDeGrilla(listaMaterialesGrilla,
						item.getCodigo());
				if (beanMaterial != null && beanMaterial.getPrice_1() != null) {
					/*
					 * agregado para calcular el importe considerando los
					 * descuentos anteriores
					 */
					Double dblPrecioTemp = new Double(beanMaterial.getPrice_1());
					if (item.getDblDesc1() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc1()) / 100;
					}
					if (item.getDblDesc2() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc2()) / 100;
					}
					if (item.getDblDesc3() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc3()) / 100;
					}
					if (item.getDblDesc4() != null) {
						dblPrecioTemp = dblPrecioTemp
								* (100 + item.getDblDesc4()) / 100;
					}
					// ///dblPrecio = new Double(beanMaterial.getPrice_1());
					dblPrecio = dblPrecioTemp;
				}
				if (item.getCantidad() != null
						&& !item.getCantidad().equals("")) {
					dblCantidad = new Double(item.getCantidad());
				}
				try {
					dblRetorno += dblCantidad.doubleValue()
							* dblPrecio.doubleValue();
				} catch (Exception e) {
				}
			}
		}
		return new Double(dblRetorno);
	}

	@SuppressWarnings("unused")
	private void setearCondicionDescuentosItems1x2x(List<Item> lista) {
		String codCliente = codigoCliente;
		String codCondPago = txtCondPago.getText();
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		for (Item i : lista) {
			if (i.getCodigo() != null && !i.getCodigo().equals("")) {
				// ///CONDICIONES COMERCIALES 1X
				List<BeanClaseMaterial> listaClasesMaterial = sqlMateriales
						.obtenerClaseMaterial(i.getCodigo());
				BeanCondicionComercial1 b1 = new BeanCondicionComercial1();
				b1.setStrCondicionPago(codCondPago);
				b1.setStrCliente(codCliente);
				b1.setListaStrClaseMaterial(listaClasesMaterial);
				List<BeanCondicionComercial1> listaCondiciones1 = sqlMateriales
						.listarCondicion1(b1);
				if (listaCondiciones1 != null && listaCondiciones1.size() == 1) {
					i.setStrCondCalc1(listaCondiciones1.get(0)
							.getStrClaseCond());
					i.setDblDesc1(listaCondiciones1.get(0).getDblImporte() / 10);
				} else {
					i.setStrCondCalc1("");
					i.setDblDesc1(new Double(0));
				}
				// ///CONDICIONES COMERCIALES 1X
				// ///CONDICIONES COMERCIALES 2X
				BeanCondicionComercial2 b2 = new BeanCondicionComercial2();
				SqlClienteImpl sqlCliente = new SqlClienteImpl();
				BeanCliente beanCliente = sqlCliente.buscarCliente(codCliente);
				b2.setStrGrupoCliente(""
						+ Integer.parseInt(beanCliente.getStrCodigoTipologia()));
				b2.setStrCanal(beanCliente.getStrCodCanalDist());
				List<BeanCondicionComercial2> listaCondiciones2 = sqlMateriales
						.listarCondicion2(b2);
				if (listaCondiciones2 != null && listaCondiciones2.size() == 1) {
					i.setStrCondCalc2(listaCondiciones2.get(0)
							.getStrClaseCond());
					i.setDblDesc2(listaCondiciones2.get(0).getDblImporte() / 10);
				} else {
					i.setStrCondCalc2("");
					i.setDblDesc2(new Double(0));
				}
			}
		}
	}

	@SuppressWarnings("unused")
	private void setearCondicionDescuentosItems3x(List<Item> lista) {
		String codCliente = codigoCliente;
		// String codCondPago = txtCondPago.getText();
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		SqlUsuarioImpl sqlUsr = new SqlUsuarioImpl();
		String strCodigoUsuario = Promesa.datose.get(0).getStrCodigo();
		BeanUsuario objUsuario = sqlUsr.obtenerDatosUsuario(strCodigoUsuario);
		for (Item i : lista) {
			if (i.getCodigo() != null && !i.getCodigo().equals("")) {
				// ///CONDICIONES COMERCIALES 3X
				BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
				// cliente
				b3.setStrCliente(codCliente);
				BeanMaterial objMat = sqlMateriales.getMaterial(i.getCodigo());
				List<BeanClaseMaterial> listClaMat = sqlMateriales
						.obtenerClaseMaterial(i.getCodigo());
				if (listClaMat != null && listClaMat.size() == 1) {
					// clase material
					b3.setStrClase(listClaMat.get(0)
							.getStrDescripcionClaseMaterial());
				} else {
					String strClaseMaterialTemp = "";
					for (BeanClaseMaterial beanClaseMaterial : listClaMat) {
						strClaseMaterialTemp += "-"
								+ beanClaseMaterial
										.getStrDescripcionClaseMaterial();
					}
					b3.setStrClase(strClaseMaterialTemp);
				}
				// jerarquia
				b3.setStrDivisionCom(objMat.getPrdha().substring(0, 2));
				b3.setStrCatProd(objMat.getPrdha().substring(2, 5));
				b3.setStrFamilia(objMat.getPrdha().substring(5, 9));
				b3.setStrLinea(objMat.getPrdha().substring(9, 13));
				b3.setStrGrupo(objMat.getPrdha().substring(13, 18));
				// material
				b3.setStrMaterial(i.getCodigo());
				// división
				if (objUsuario.getStrDivision() != null
						&& !objUsuario.getStrDivision().equals("")) {
					b3.setStrDivisionC(""
							+ Integer.parseInt(objUsuario.getStrDivision()));
				} else {
					b3.setStrDivisionC("");
				}
				Double dblImportePedido = calculaImportePedidoClaseCondicion3x(
						lista, i);
				BeanCondicionComercial3x beanCondicion3 = null;
				Double dblDscto = new Double(0);

				List<BeanCondicionComercial3x> listaCondiciones3x = sqlMateriales
						.listarCondicion3(b3);
				if (listaCondiciones3x != null
						&& listaCondiciones3x.size() == 1) {
					i.setStrCondCalc3(listaCondiciones3x.get(0)
							.getStrClaseCond());
					beanCondicion3 = listaCondiciones3x.get(0);
					if (beanCondicion3.getStrEscala().equals("X")) {
						dblDscto = beanCondicion3
								.getDblImporteEscala(dblImportePedido) / 10;
					} else {
						dblDscto = beanCondicion3.getDblImporte() / 10;
					}
					i.setDblDesc3(dblDscto);
				} else {
					i.setStrCondCalc3("");
				}
			}
		}
	}

	@SuppressWarnings("unused")
	private void setearCondicionDescuentosItems4x(List<Item> lista) {
		String codCliente = codigoCliente;
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		SqlUsuarioImpl sqlUsr = new SqlUsuarioImpl();
		String strCodigoUsuario = Promesa.datose.get(0).getStrCodigo();
		BeanUsuario objUsuario = sqlUsr.obtenerDatosUsuario(strCodigoUsuario);
		for (Item i : lista) {
			if (i.getCodigo() != null && !i.getCodigo().equals("")) {
				// ///CONDICIONES COMERCIALES 3X
				BeanCondicionComercial3x b3 = new BeanCondicionComercial3x();
				// cliente
				b3.setStrCliente(codCliente);
				BeanMaterial objMat = sqlMateriales.getMaterial(i.getCodigo());
				List<BeanClaseMaterial> listClaMat = sqlMateriales
						.obtenerClaseMaterial(i.getCodigo());
				if (listClaMat != null && listClaMat.size() == 1) {
					// clase material
					b3.setStrClase(listClaMat.get(0)
							.getStrDescripcionClaseMaterial());
				}
				// jerarquia
				b3.setStrDivisionCom(objMat.getPrdha().substring(0, 2));
				b3.setStrCatProd(objMat.getPrdha().substring(2, 5));
				b3.setStrFamilia(objMat.getPrdha().substring(5, 9));
				b3.setStrLinea(objMat.getPrdha().substring(9, 13));
				b3.setStrGrupo(objMat.getPrdha().substring(13, 18));
				// material
				b3.setStrMaterial(i.getCodigo());
				// división
				// b3.setStrDivisionC(objUsuario.getStrDivision());
				if (objUsuario.getStrDivision() != null
						&& !objUsuario.getStrDivision().equals("")) {
					b3.setStrDivisionC(""
							+ Integer.parseInt(objUsuario.getStrDivision()));
				} else {
					b3.setStrDivisionC("");
				}
				Double dblDscto = new Double(0);
				List<BeanCondicionComercial4x> listaCondiciones4x = sqlMateriales
						.listarCondicion4(b3);
				if (listaCondiciones4x != null
						&& listaCondiciones4x.size() == 1) {
					i.setStrCondCalc4(listaCondiciones4x.get(0)
							.getStrClaseCond());
				} else {
					i.setStrCondCalc4("");
				}

				Double dblCantidadPedido = calculaCantidadPedidoClaseCondicion(
						lista, i);
				BeanCondicionComercial4x beanCondicion4 = null;
				if (listaCondiciones4x != null
						&& listaCondiciones4x.size() == 1) {
					beanCondicion4 = listaCondiciones4x.get(0);
					if (beanCondicion4.getStrEscala().equals("X")) {
						dblDscto = beanCondicion4
								.getDblImporteEscala(dblCantidadPedido) / 10;
					} else {
						dblDscto = beanCondicion4.getDblImporte() / 10;
					}
					i.setDblDesc4(dblDscto);

				} else {
					beanCondicion4 = new BeanCondicionComercial4x();
					beanCondicion4.setStrClaseCond("No aplica");
					i.setDblDesc4(new Double(0));
				}
			}
		}
	}

	// Variables declaration - do not modify
	protected javax.swing.JButton btnAniadir;
	protected javax.swing.JButton btnCancelar;
	protected javax.swing.JButton btnConsultaCapturaDinamica;
	protected javax.swing.JButton btnDetalleBloqEntrega;
	protected javax.swing.JButton btnDetalleCondPago;
	protected javax.swing.JButton btnDetalleDestinatario;
	protected javax.swing.JButton btnEliminar;
	protected javax.swing.JButton btnGuardarOrden;
	protected javax.swing.JButton btnGuiaVentas;
	protected javax.swing.JButton btnSimularTodo;
	protected javax.swing.JButton btnImprimirComprobante;
	protected javax.swing.JPanel jPanel9;
	protected javax.swing.JLabel lblBloqEntrega;
	protected javax.swing.JLabel lblClasRiesgo;
	protected javax.swing.JLabel lblCondPago;
	protected javax.swing.JLabel lblDestinatario;
	protected javax.swing.JLabel lblDisponible;
	protected javax.swing.JLabel lblLimCredito;
	protected javax.swing.JLabel lblMensajes;
	protected javax.swing.JLabel lblNPedCliente;
	protected javax.swing.JLabel lblNombre;
	protected javax.swing.JLabel lblTitulo;
	protected javax.swing.JLabel lblValorNeto;
	protected javax.swing.JLabel lblVtaMercaderia;
	protected javax.swing.JToolBar mnuToolBarMiddle;
	protected javax.swing.JToolBar mnuToolBarTop;
	protected javax.swing.JPanel pnlBackground;
	protected javax.swing.JPanel pnlBloqEntrega;
	protected javax.swing.JPanel pnlContenedor;
	protected javax.swing.JPanel pnlCuatro;
	protected javax.swing.JPanel pnlDatos;
	protected javax.swing.JPanel pnlDos;
	protected javax.swing.JPanel pnlInformacion;
	protected javax.swing.JPanel pnlInformacionGeneral;
	protected javax.swing.JPanel pnlLabels3;
	protected javax.swing.JPanel pnlLabels4;
	protected javax.swing.JPanel pnlLabelsDos;
	protected javax.swing.JPanel pnlLabelsUno;
	protected javax.swing.JPanel pnlTabla;
	protected javax.swing.JPanel pnlTexts4;
	protected javax.swing.JPanel pnlTextsDos;
	protected javax.swing.JPanel pnlTextsTres;
	protected javax.swing.JPanel pnlTextsUno;
	protected javax.swing.JPanel pnlTres;
	protected javax.swing.JPanel pnlUno;
	protected javax.swing.JPanel pnlVtaMercaderia;
	protected javax.swing.JPanel pnlWarnings;
	protected javax.swing.JLabel lblWarnigs;
	protected javax.swing.JScrollPane scroller;
	protected javax.swing.JSeparator separador;
	protected javax.swing.JToolBar.Separator separador2;
	protected javax.swing.JToolBar.Separator separador3;
	protected javax.swing.JToolBar.Separator separador4;
	protected javax.swing.JToolBar.Separator separador5;
	protected javax.swing.JTable tblPedidos;
	protected javax.swing.JTextField txtBloqEntrega;
	protected javax.swing.JTextField txtClasRiesgo;
	protected javax.swing.JTextField txtCodigoPedido;
	protected javax.swing.JTextField txtCondPago;
	protected javax.swing.JTextField txtDestinatario;
	protected javax.swing.JTextField txtDisponible;
	protected javax.swing.JTextField txtLimCredito;
	protected javax.swing.JTextField txtNPedCliente;
	protected javax.swing.JTextField txtNombre;
	protected javax.swing.JTextField txtValorNeto;
	protected javax.swing.JComboBox cmbCondExped;
	protected Separator separador8;
	protected ModeloTablaItems mdlTblItems = new ModeloTablaItems();
	protected RenderizadorTablaItems render = new RenderizadorTablaItems();
	// Sucursales
	protected JPopupMenu popupSucursales = null;
	protected JScrollPane scrollSucursales;
	protected JTable tablaSucursales = new JTable();
	protected String Columnas[] = { "CÓDIGO", "DIRECCIÓN" };

	protected DefaultTableModel modeloSucursales = new DefaultTableModel(
			new Object[][] {}, Columnas) {
		public boolean isCellEditable(int row, int column) {
			return false;
		}
	};
	// Bloqueos de entrega
	protected JPopupMenu popupBloqueo = null;
	protected JScrollPane scrollerBloqueo;
	protected JTable tablaBloqueos = new JTable();
	protected String Columnas3[] = { "CÓDIGO", "DESCRIPCIÓN" };
	protected DefaultTableModel modeloBloqueo = new DefaultTableModel(
			new Object[][] {}, Columnas3) {
		public boolean isCellEditable(int row, int column) {
			return false;
		}
	};
	// Condiciones de pago
	protected JPopupMenu popupCondiciones = null;
	protected JScrollPane scrollerCondiciones;
	protected JTable tablaCondiciones = new JTable();
	protected String Columnas2[] = { "CONDICIÓN DE PAGO", "ACLARACIÓN PROPIA" };
	protected SqlCondicionPagoImpl condiciones;
	protected DefaultTableModel modelCondiciones = new DefaultTableModel(
			new Object[][] {}, Columnas2) {
		public boolean isCellEditable(int row, int column) {
			return false;
		}
	};
	protected ListSelectionModel selectionModel;
	protected String codigoCliente = "";
	protected String nombreCliente = "";
	protected String direccionDestinatario = "";
	protected String descripcionCondicionPago = "";
	protected String bloqueoEntrega = "";
	protected String condicionExpedicion = "";
	protected String numeroPedidoCliente = "";
	protected String claseRiesgo = "";
	protected String limiteCredito = "";
	protected String disponibilidad = "";
	protected String condicionPago = "";
	protected String organizacionVentas = "";
	protected String canalDistribucion = "";
	protected String codigoSector = "";
	protected String tipoDocumento = "";
	protected String iva = null;
	protected int tipoVentana;
	protected BeanPedido pedido;
	protected JTextField textFieldCodigo;
	protected JTextField textFieldCantidad;
	protected JTextField textFieldPorcentajeDescuento;
	// End of variables declaration
	protected IPedidos instancia;
	protected String tituloImpresion;
	protected boolean editable = true;
	public HashMap<String, List<Item>> mapaItems;
	protected String source;
	private String strDispositivoImpresora;
	protected HashMap<String, String> marcadosParaActualizar;

	private BeanMaterial obtenerMaterialDeGrilla(List<BeanMaterial> lista,
			String strCodMaterial) {
		for (BeanMaterial beanMaterial : lista) {
			if (beanMaterial != null) {
				if (beanMaterial.getIdMaterial().equals(strCodMaterial))
					return beanMaterial;
			}
		}
		return null;
	}

	protected void agregarMaterialPorEventoTab01() {
		int fila = tblPedidos.getSelectedRow();
		SqlMaterialImpl sqlMateriales = new SqlMaterialImpl();
		SqlComboImpl sqlCombos = new SqlComboImpl();
		String codigo = textFieldCodigo.getText();
		if (codigo.equals("")) {
			return;
		} else if (!mdlTblItems.yaEstaAgregado(codigo, fila)) {
			BeanMaterial mat = sqlMateriales.getMaterial(codigo);
			boolean vacio = false;
			if (mat != null) {
				Item material = new Item();
				material.setDenominacion(sqlMateriales.obtenerNombreMaterial(codigo));
				material.setPosicion(mdlTblItems.getValueAt(fila, 0).toString());
				material.setCodigo(textFieldCodigo.getText());
				material.setUnidad(mat.getUn());
				material.setCantidad(mdlTblItems.getValueAt(fila, 2).toString());
				material.setCantidadConfirmada(mdlTblItems.getValueAt(fila, 3).toString());
				material.setPorcentajeDescuento(mdlTblItems.getValueAt(fila, 5).toString());
				material.setPrecioNeto(mdlTblItems.obtenerItem(fila).getPrecioNeto());
				material.setValorNeto(mdlTblItems.obtenerItem(fila).getValorNeto());
				material.setTipo(0); // Item normal
				material.setEditable(true);

				String tipoMaterial = mat.getTypeMat();
				SqlClienteImpl sql = new SqlClienteImpl();
				String check = sql.obtenerMarcaBloqueoAlmacen(codigoCliente);
				if (tipoMaterial.compareTo("B") == 0 && check.compareTo("1") == 0) { // BODEGA
					tipoMaterial = "B";
				} else if (tipoMaterial.compareTo("N") == 0 || (tipoMaterial.compareTo("B") == 0 && check.compareTo("0") == 0)) { // NORMAL
					tipoMaterial = "N";
				} else if (tipoMaterial.compareTo("P") == 0) { // PESADO
					tipoMaterial = "P";
				} else if (tipoMaterial.compareTo("R") == 0) { // ROJO
					tipoMaterial = "R";
				}
				material.setTipoMaterial(tipoMaterial);
				material.setSimulado(false);
				mdlTblItems.agregarItem(material, fila);
				tblPedidos.updateUI();
			} else {
				Item combo = sqlCombos.getCombo(codigo);
				if (combo != null) {
					if (!mdlTblItems.existeCombo(codigo)) {
						combo.setCantidad("1");
						combo.setCantidadConfirmada(mdlTblItems.getValueAt(fila, 3).toString());
						combo.setPorcentajeDescuento(mdlTblItems.getValueAt(fila, 5).toString());
						mdlTblItems.agregarItem(combo, fila);
						tblPedidos.updateUI();
					}
				} else {
					vacio = true;
				}
			}
			if (vacio) {
				lblMensajes.setBorder(javax.swing.BorderFactory
						.createEmptyBorder(1, 10, 1, 1));
				lblMensajes
						.setText("<html><font color='red'>EL MATERIAL SELECCIONADO NO EXISTE</font></html>");
				textFieldCodigo.selectAll();
			} else {
				lblMensajes.setText("");
				actualizarPosiciones();
				tblPedidos.editCellAt(fila, 2);
				this.textFieldPorcentajeDescuento.requestFocusInWindow();
				this.textFieldPorcentajeDescuento.setEditable(true);
				selectionModel.setSelectionInterval(fila, fila);
			}
		} else {
			tblPedidos.editCellAt(fila, 1);
			this.textFieldPorcentajeDescuento.requestFocusInWindow();
			this.textFieldPorcentajeDescuento.selectAll();
			this.textFieldPorcentajeDescuento.setEditable(true);
		}
	}
}